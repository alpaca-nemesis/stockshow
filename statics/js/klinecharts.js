/**
 * @license
 * KLineChart v9.0.0-alpha4
 * Copyright (c) 2019 lihu.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).klinecharts={})}(this,(function(t){"use strict";const e=new class{constructor(){this._baseId=1}next(t){const e=(new Date).getTime();return e===this._prevIdTimestamp?++this._baseId:this._baseId=1,this._prevIdTimestamp=e,`${null!=t?t:""}${e}_${this._baseId}`}};function i(t){return e.next(t)}function n(t,e){var i;const n=document.createElement(t),s=null!=e?e:{};for(const t in s)n.style[t]=null!==(i=s[t])&&void 0!==i?i:"";return n}let s;function o(t){var e,i,n;return null!==(n=null===(i=null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)||void 0===i?void 0:i.devicePixelRatio)&&void 0!==n?n:2}function a(t,e,i){return`${null!=e?e:"normal"} ${null!=t?t:12}px ${null!=i?i:"Helvetica Neue"}`}function r(t,e,i,n){if(void 0===s){const t=document.createElement("canvas"),e=o(t);s=t.getContext("2d"),s.scale(e,e)}return s.font=a(e,i,n),Math.round(s.measureText(t).width)}function l(t,e){if(d(t)||d(e))for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)){const n=t[i],s=e[i];d(s)&&d(n)&&!h(s)&&!h(n)?l(n,s):v(e[i])&&(t[i]=e[i])}}function c(t){if(!d(t)||!h(t))return t;let e;e=h(t)?[]:{};for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const n=t[i];d(n)?e[i]=c(n):e[i]=n}return e}function h(t){return"[object Array]"===Object.prototype.toString.call(t)}function u(t){return"function"==typeof t}function d(t){return"object"==typeof t}function g(t){return"number"==typeof t&&!isNaN(t)}function v(t){return null!=t}function m(t){return"string"==typeof t}const p=/\\(\\)?/g,_=RegExp("[^.[\\]]+|\\[(?:([^\"'][^[]*)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))","g");function f(t,e,i){if(v(t)){const n=[];e.replace(_,((t,...e)=>{let i=t;return v(e[1])?i=e[2].replace(p,"$1"):v(e[0])&&(i=e[0].trim()),n.push(i),""}));let s=t,o=0;const a=n.length;for(;v(s)&&o<a;)s=null==s?void 0:s[n[o++]];return v(s)?s:null!=i?i:"--"}return null!=i?i:"--"}function x(t,e,i){const n=t.format(new Date(e)).split(", "),s=n[0].split("/"),o=n[1].split(":"),a={YYYY:s[2],MM:s[0],DD:s[1],HH:"24"===o[0]?"00":o[0],mm:o[1],ss:o[2]};return i.replace(/YYYY|MM|DD|HH|mm|ss/g,(t=>a[t]))}function y(t,e){const i=+t;return g(i)?i.toFixed(null!=e?e:2):`${i}`}function S(t){const e=+t;return g(e)?t>1e9?+(e/1e9).toFixed(3)+"B":t>1e6?+(e/1e6).toFixed(3)+"M":t>1e3?+(e/1e3).toFixed(3)+"K":`${t}`:"--"}function C(t,e,i){let n=0,s=0;for(s=t.length-1;n!==s;){const o=Math.floor((s+n)/2),a=s-n,r=t[o][e];if(i===t[n][e])return n;if(i===t[s][e])return s;if(i===r)return o;if(i>r?n=o:s=o,a<=2)break}return n}function b(t,e){null==e&&(e=10),e=Math.min(Math.max(0,e),20);return+(+t).toFixed(e)}function w(t,e,i){const n=[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER];return t.forEach((t=>{var s,o;n[0]=Math.max(null!==(s=t[e])&&void 0!==s?s:t,n[0]),n[1]=Math.min(null!==(o=t[i])&&void 0!==o?o:t,n[1])})),n}function E(t){return Math.log(t)/Math.log(10)}function I(t){return Math.pow(10,t)}const T=1,P=50;class M{constructor(t){this._dateTimeFormat=this._buildDateTimeFormat(),this._zoomEnabled=!0,this._scrollEnabled=!0,this._loading=!0,this._loadMoreCallback=null,this._more=!0,this._totalBarSpace=0,this._barSpace=6,this._offsetRightDistance=50,this._startScrollOffsetRightBarCount=0,this._minVisibleBarCount={left:2,right:2},this._visibleRange={from:0,to:0},this._chartStore=t,this._gapBarSpace=this._calcGapBarSpace(),this._offsetRightBarCount=this._offsetRightDistance/this._barSpace}_calcGapBarSpace(){const t=Math.floor(.82*this._barSpace),e=Math.floor(this._barSpace),i=Math.min(t,e-1);return Math.max(1,i)}adjustVisibleRange(){var t;const e=this._chartStore.getDataList(),i=e.length,n=this._totalBarSpace/this._barSpace,s=n-Math.min(this._minVisibleBarCount.left,i);this._offsetRightBarCount>s&&(this._offsetRightBarCount=s);const o=-i+Math.min(this._minVisibleBarCount.right,i);this._offsetRightBarCount<o&&(this._offsetRightBarCount=o);let a=Math.round(this._offsetRightBarCount+i+.5);a>i&&(a=i);let r=Math.round(a-n)-1;if(r<0&&(r=0),this._visibleRange={from:r,to:a},this._chartStore.getActionStore().execute("onVisibleDataChange",{from:r,to:a}),this._chartStore.adjustVisibleDataList(),0===r&&this._more&&!this._loading&&null!==this._loadMoreCallback){this._loading=!0;const i=e[0];this._loadMoreCallback(null!==(t=null==i?void 0:i.timestamp)&&void 0!==t?t:null)}}setMore(t){return this._more=t,this}setLoading(t){return this._loading=t,this}getDateTimeFormat(){return this._dateTimeFormat}_buildDateTimeFormat(t){const e={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};void 0!==t&&(e.timeZone=t);let i=null;try{i=new Intl.DateTimeFormat("en",e)}catch(t){}return i}setTimezone(t){const e=this._buildDateTimeFormat(t);null!==e&&(this._dateTimeFormat=e)}getTimezone(){return this._dateTimeFormat.resolvedOptions().timeZone}getBarSpace(){return{bar:this._barSpace,halfBar:this._barSpace/2,gapBar:this._gapBarSpace,halfGapBar:this._gapBarSpace/2}}setBarSpace(t,e){t<T||t>P||this._barSpace===t||(this._barSpace=t,this._gapBarSpace=this._calcGapBarSpace(),null==e||e(),this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0))}setTotalBarSpace(t){return this._totalBarSpace!==t&&(this._totalBarSpace=t,this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0)),this}setOffsetRightDistance(t,e){return this._offsetRightDistance=t,this._offsetRightBarCount=t/this._barSpace,null!=e&&e&&(this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0)),this}resetOffsetRightDistance(){this.setOffsetRightDistance(this._offsetRightDistance)}getOffsetRightDistance(){return this._offsetRightDistance}getOffsetRightBarCount(){return this._offsetRightBarCount}setOffsetRightBarCount(t){return this._offsetRightBarCount=t,this}setLeftMinVisibleBarCount(t){return this._minVisibleBarCount.left=t,this}setRightMinVisibleBarCount(t){return this._minVisibleBarCount.right=t,this}getVisibleRange(){return this._visibleRange}startScroll(){this._startScrollOffsetRightBarCount=this._offsetRightBarCount}scroll(t){if(!this._scrollEnabled)return;const e=t/this._barSpace;this._chartStore.getActionStore().execute("onScroll"),this._offsetRightBarCount=this._startScrollOffsetRightBarCount-e,this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0)}getDataByDataIndex(t){var e;return null!==(e=this._chartStore.getDataList()[t])&&void 0!==e?e:null}coordinateToFloatIndex(t){const e=this._chartStore.getDataList().length,i=(this._totalBarSpace-t)/this._barSpace,n=e+this._offsetRightBarCount-i;return Math.round(1e6*n)/1e6}dataIndexToTimestamp(t){var e;const i=this.getDataByDataIndex(t);return null!==(e=null==i?void 0:i.timestamp)&&void 0!==e?e:null}timestampToDataIndex(t){const e=this._chartStore.getDataList();return 0===e.length?0:C(e,"timestamp",t)}dataIndexToCoordinate(t){const e=this._chartStore.getDataList().length+this._offsetRightBarCount-t;return this._totalBarSpace-(e-.5)*this._barSpace}coordinateToDataIndex(t){return Math.ceil(this.coordinateToFloatIndex(t))-1}zoom(t,e){if(!this._zoomEnabled)return;if(void 0===(null==e?void 0:e.x)){const t=this._chartStore.getCrosshairStore().get();e={x:void 0!==(null==t?void 0:t.x)?t.x:this._totalBarSpace/2}}this._chartStore.getActionStore().execute("onZoom");const i=this.coordinateToFloatIndex(e.x),n=this._barSpace+t*(this._barSpace/10);this.setBarSpace(n,(()=>{this._offsetRightBarCount+=i-this.coordinateToFloatIndex(null==e?void 0:e.x)}))}setZoomEnabled(t){return this._zoomEnabled=t,this}getZoomEnabled(){return this._zoomEnabled}setScrollEnabled(t){return this._scrollEnabled=t,this}getScrollEnabled(){return this._scrollEnabled}setLoadMoreCallback(t){return this._loadMoreCallback=t,this}clear(){this._more=!0,this._loading=!0,this._visibleRange={from:0,to:0}}}function D(t,e,i,n,s){const o=e.result,a=e.figures,r=e.styles,l=f(r,"circles",n.circles),c=l.length,h=f(r,"bars",n.bars),u=h.length,d=f(r,"lines",n.lines),g=d.length;let m,p,_,x=0,y=0,S=0,C=0;a.forEach((a=>{var r,f,b,w;switch(a.type){case"circle":m=l[x%c],p=m.style,_=m.noChangeColor,C=x,x++;break;case"bar":m=h[y%u],p=m.style,_=m.noChangeColor,C=y,y++;break;case"line":m=d[S%g],p=m.style,_=m.color,C=S,S++}if(v(m)){const l={prev:{kLineData:t[i-1],indicatorData:o[i-1]},current:{kLineData:t[i],indicatorData:o[i]},next:{kLineData:t[i+1],indicatorData:o[i+1]}},c=null!==(f=null===(r=a.styles)||void 0===r?void 0:r.call(a,l,e,n))&&void 0!==f?f:{style:p,color:_};s(a,{style:null!==(b=c.style)&&void 0!==b?b:p,color:null!==(w=c.color)&&void 0!==w?w:_},m,C)}}))}class k{constructor(t){this.result=[],this._precisionFlag=!1;const{name:e,shortName:i,series:n,calcParams:s,figures:o,precision:a,shouldOhlc:r,shouldFormatBigNumber:l,minValue:c,maxValue:h,styles:u,extendData:d,regenerateFigures:g,createToolTipDataSource:v,draw:m}=t;this.name=e,this.shortName=null!=i?i:e,this.series=null!=n?n:"normal",this.precision=null!=a?a:4,this.calcParams=null!=s?s:[],this.figures=null!=o?o:[],this.shouldOhlc=null!=r&&r,this.shouldFormatBigNumber=null!=l&&l,this.minValue=null!=c?c:null,this.maxValue=null!=h?h:null,this.styles=null!=u?u:null,this.extendData=d,this.regenerateFigures=null!=g?g:null,this.createToolTipDataSource=null!=v?v:null,this.draw=null!=m?m:null}setShortName(t){return this.shortName!==t&&(this.shortName=t,!0)}setSeries(t){return this.series!==t&&(this.series=t,!0)}setPrecision(t,e){const i=null!=e&&e,n=Math.floor(t);return!(!(n!==this.precision&&t>=0)||i&&(!i||this._precisionFlag))&&(this.precision=n,i||(this._precisionFlag=!0),!0)}setCalcParams(t){var e,i;return this.calcParams=t,this.figures=null!==(i=null===(e=this.regenerateFigures)||void 0===e?void 0:e.call(this,t))&&void 0!==i?i:this.figures,!0}setShouldOhlc(t){return this.shouldOhlc!==t&&(this.shouldOhlc=t,!0)}setShouldFormatBigNumber(t){return this.shouldFormatBigNumber!==t&&(this.shouldFormatBigNumber=t,!0)}setStyles(t){return this.styles!==t&&(this.styles=t,!0)}setExtendData(t){return this.extendData!==t&&(this.extendData=t,!0)}setFigures(t){return this.figures!==t&&(this.figures=t,!0)}setMinValue(t){return this.minValue!==t&&(this.minValue=t,!0)}setMaxValue(t){return this.maxValue!==t&&(this.maxValue=t,!0)}setRegenerateFigures(t){return this.regenerateFigures!==t&&(this.regenerateFigures=t,!0)}setCreateToolTipDataSource(t){return this.createToolTipDataSource!==t&&(this.createToolTipDataSource=t,!0)}setDraw(t){return this.draw!==t&&(this.draw=t,!0)}async calcIndicator(t){try{const e=await this.calc(t,this);return this.result=e,!0}catch(t){return!1}}static extend(t){return class extends k{constructor(){super(t)}calc(e,i){return t.calc(e,i)}}}}const A={name:"RSI",shortName:"RSI",calcParams:[6,12,24],figures:[{key:"rsi1",title:"RSI1: ",type:"line"},{key:"rsi2",title:"RSI2: ",type:"line"},{key:"rsi3",title:"RSI3: ",type:"line"}],regenerateFigures:t=>t.map(((t,e)=>{const i=e+1;return{key:`rsi${i}`,title:`RSI${i}: `,type:"line"}})),calc:(t,e)=>{const{calcParams:i,figures:n}=e,s=[],o=[];return t.map(((e,a)=>{var r;const l={},c=(null!==(r=t[a-1])&&void 0!==r?r:e).close,h=e.close-c;return i.forEach(((e,i)=>{var r,c,u;if(h>0?s[i]=(null!==(r=s[i])&&void 0!==r?r:0)+h:o[i]=(null!==(c=o[i])&&void 0!==c?c:0)+Math.abs(h),a>=e-1){0!==o[i]?l[n[i].key]=100-100/(1+s[i]/o[i]):l[n[i].key]=0;const r=t[a-(e-1)],c=null!==(u=t[a-e])&&void 0!==u?u:r,h=r.close-c.close;h>0?s[i]-=h:o[i]-=Math.abs(h)}})),l}))}},F={name:"VOL",shortName:"VOL",series:"volume",calcParams:[5,10,20],shouldFormatBigNumber:!0,precision:0,minValue:0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA20: ",type:"line"},{key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:(t,e,i)=>{const n=t.current.kLineData;let s;return s=n.close>n.open?f(e.styles,"bars[0].upColor",i.bars[0].upColor):n.close<n.open?f(e.styles,"bars[0].downColor",i.bars[0].downColor):f(e.styles,"bars[0].noChangeColor",i.bars[0].noChangeColor),{color:s}}}],regenerateFigures:t=>{const e=t.map(((t,e)=>({key:`ma${e+1}`,title:`MA${t}: `,type:"line"})));return e.push({key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:(t,e,i)=>{const n=t.current.kLineData;let s;return s=n.close>n.open?f(e.styles,"bars[0].upColor",i.bars[0].upColor):n.close<n.open?f(e.styles,"bars[0].downColor",i.bars[0].downColor):f(e.styles,"bars[0].noChangeColor",i.bars[0].noChangeColor),{color:s}}}),e},calc:(t,e)=>{const{calcParams:i,figures:n}=e,s=[];return t.map(((e,o)=>{var a;const r=null!==(a=e.volume)&&void 0!==a?a:0,l={volume:r};return i.forEach(((e,i)=>{var a,c;s[i]=(null!==(a=s[i])&&void 0!==a?a:0)+r,o>=e-1&&(l[n[i].key]=s[i]/e,s[i]-=null!==(c=t[o-(e-1)].volume)&&void 0!==c?c:0)})),l}))}},L={name:"WR",shortName:"WR",calcParams:[6,10,14],figures:[{key:"wr1",title:"WR1: ",type:"line"},{key:"wr2",title:"WR2: ",type:"line"},{key:"wr3",title:"WR3: ",type:"line"}],regenerateFigures:t=>t.map(((t,e)=>({key:`wr${e+1}`,title:`WR${e+1}: `,type:"line"}))),calc:(t,e)=>{const{calcParams:i,figures:n}=e;return t.map(((e,s)=>{const o={},a=e.close;return i.forEach(((e,i)=>{const r=e-1;if(s>=r){const e=w(t.slice(s-r,s+1),"high","low"),l=e[0],c=l-e[1];o[n[i].key]=0===c?0:(a-l)/c*100}})),o}))}},R={},B=[{name:"AVP",shortName:"AVP",series:"price",precision:2,figures:[{key:"avp",title:"AVP: ",type:"line"}],calc:t=>{let e=0,i=0;return t.map((t=>{var n,s;const o={},a=null!==(n=null==t?void 0:t.turnover)&&void 0!==n?n:0,r=null!==(s=null==t?void 0:t.volume)&&void 0!==s?s:0;return e+=a,i+=r,0!==i&&(o.avp=e/i),o}))}},{name:"AO",shortName:"AO",calcParams:[5,34],figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:(t,e,i)=>{var n,s,o,a;const{prev:r,current:l}=t,c=null!==(s=null===(n=r.indicatorData)||void 0===n?void 0:n.ao)&&void 0!==s?s:Number.MIN_SAFE_INTEGER,h=null!==(a=null===(o=l.indicatorData)||void 0===o?void 0:o.ao)&&void 0!==a?a:Number.MIN_SAFE_INTEGER;let u;u=h>c?f(e.styles,"bars[0].upColor",i.bars[0].upColor):f(e.styles,"bars[0].downColor",i.bars[0].downColor);return{color:u,style:h>c?"stroke":"fill"}}}],calc:(t,e)=>{const i=e.calcParams,n=Math.max(i[0],i[1]);let s=0,o=0,a=0,r=0;return t.map(((e,l)=>{const c={},h=(e.low+e.high)/2;if(s+=h,o+=h,l>=i[0]-1){a=s/i[0];const e=t[l-(i[0]-1)];s-=(e.low+e.high)/2}if(l>=i[1]-1){r=o/i[1];const e=t[l-(i[1]-1)];o-=(e.low+e.high)/2}return l>=n-1&&(c.ao=a-r),c}))}},{name:"BIAS",shortName:"BIAS",calcParams:[6,12,24],figures:[{key:"bias1",title:"BIAS6: ",type:"line"},{key:"bias2",title:"BIAS12: ",type:"line"},{key:"bias3",title:"BIAS24: ",type:"line"}],regenerateFigures:t=>t.map(((t,e)=>({key:`bias${e+1}`,title:`BIAS${t}: `,type:"line"}))),calc:(t,e)=>{const{calcParams:i,figures:n}=e,s=[];return t.map(((e,o)=>{const a={},r=e.close;return i.forEach(((e,l)=>{var c;if(s[l]=(null!==(c=s[l])&&void 0!==c?c:0)+r,o>=e-1){const c=s[l]/i[l];a[n[l].key]=(r-c)/c*100,s[l]-=t[o-(e-1)].close}})),a}))}},{name:"BOLL",shortName:"BOLL",series:"price",calcParams:[20,2],precision:2,shouldOhlc:!0,figures:[{key:"up",title:"UP: ",type:"line"},{key:"mid",title:"MID: ",type:"line"},{key:"dn",title:"DN: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=i[0]-1;let s=0;return t.map(((e,o)=>{const a=e.close,r={};if(s+=a,o>=n){r.mid=s/i[0];const e=function(t,e){const i=t.length;let n=0;return t.forEach((t=>{const i=t.close-e;n+=i*i})),n=Math.abs(n),Math.sqrt(n/i)}(t.slice(o-n,o+1),r.mid);r.up=r.mid+i[1]*e,r.dn=r.mid-i[1]*e,s-=t[o-n].close}return r}))}},{name:"BRAR",shortName:"BRAR",calcParams:[26],figures:[{key:"br",title:"BR: ",type:"line"},{key:"ar",title:"AR: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,s=0,o=0,a=0;return t.map(((e,r)=>{var l,c;const h={},u=e.high,d=e.low,g=e.open,v=(null!==(l=t[r-1])&&void 0!==l?l:e).close;if(o+=u-g,a+=g-d,n+=u-v,s+=v-d,r>=i[0]-1){h.ar=0!==a?o/a*100:0,h.br=0!==s?n/s*100:0;const e=t[r-(i[0]-1)],l=e.high,u=e.low,d=e.open,g=(null!==(c=t[r-i[0]])&&void 0!==c?c:t[r-(i[0]-1)]).close;n-=l-g,s-=g-u,o-=l-d,a-=d-u}return h}))}},{name:"BBI",shortName:"BBI",series:"price",precision:2,calcParams:[3,6,12,24],shouldOhlc:!0,figures:[{key:"bbi",title:"BBI: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=Math.max(...i),s=[],o=[];return t.map(((e,a)=>{const r={},l=e.close;if(i.forEach(((e,i)=>{var n;s[i]=(null!==(n=s[i])&&void 0!==n?n:0)+l,a>=e-1&&(o[i]=s[i]/e,s[i]-=t[a-(e-1)].close)})),a>=n-1){let t=0;o.forEach((e=>{t+=e})),r.bbi=t/4}return r}))}},{name:"CCI",shortName:"CCI",calcParams:[20],figures:[{key:"cci",title:"CCI: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=i[0]-1;let s=0;const o=[];return t.map(((e,a)=>{const r={},l=(e.high+e.low+e.close)/3;if(s+=l,o.push(l),a>=n){const e=s/i[0],c=o.slice(a-n,a+1);let h=0;c.forEach((t=>{h+=Math.abs(t-e)}));const u=h/i[0];r.cci=0!==u?(l-e)/u/.015:0;const d=(t[a-n].high+t[a-n].low+t[a-n].close)/3;s-=d}return r}))}},{name:"CR",shortName:"CR",calcParams:[26,10,20,40,60],figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=Math.ceil(i[1]/2.5+1),s=Math.ceil(i[2]/2.5+1),o=Math.ceil(i[3]/2.5+1),a=Math.ceil(i[4]/2.5+1);let r=0;const l=[];let c=0;const h=[];let u=0;const d=[];let g=0;const v=[],m=[];return t.forEach(((e,p)=>{var _,f,x,y,S;const C={},b=null!==(_=t[p-1])&&void 0!==_?_:e,w=(b.high+b.close+b.low+b.open)/4,E=Math.max(0,e.high-w),I=Math.max(0,w-e.low);p>=i[0]-1&&(C.cr=0!==I?E/I*100:0,r+=C.cr,c+=C.cr,u+=C.cr,g+=C.cr,p>=i[0]+i[1]-2&&(l.push(r/i[1]),p>=i[0]+i[1]+n-3&&(C.ma1=l[l.length-1-n]),r-=null!==(f=m[p-(i[1]-1)].cr)&&void 0!==f?f:0),p>=i[0]+i[2]-2&&(h.push(c/i[2]),p>=i[0]+i[2]+s-3&&(C.ma2=h[h.length-1-s]),c-=null!==(x=m[p-(i[2]-1)].cr)&&void 0!==x?x:0),p>=i[0]+i[3]-2&&(d.push(u/i[3]),p>=i[0]+i[3]+o-3&&(C.ma3=d[d.length-1-o]),u-=null!==(y=m[p-(i[3]-1)].cr)&&void 0!==y?y:0),p>=i[0]+i[4]-2&&(v.push(g/i[4]),p>=i[0]+i[4]+a-3&&(C.ma4=v[v.length-1-a]),g-=null!==(S=m[p-(i[4]-1)].cr)&&void 0!==S?S:0)),m.push(C)})),m}},{name:"DMA",shortName:"DMA",calcParams:[10,50,10],figures:[{key:"dma",title:"DMA: ",type:"line"},{key:"ama",title:"AMA: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=Math.max(i[0],i[1]);let s=0,o=0,a=0;const r=[];return t.forEach(((e,l)=>{var c;const h={},u=e.close;s+=u,o+=u;let d=0,g=0;if(l>=i[0]-1&&(d=s/i[0],s-=t[l-(i[0]-1)].close),l>=i[1]-1&&(g=o/i[1],o-=t[l-(i[1]-1)].close),l>=n-1){const t=d-g;h.dma=t,a+=t,l>=n+i[2]-2&&(h.ama=a/i[2],a-=null!==(c=r[l-(i[2]-1)].dma)&&void 0!==c?c:0)}r.push(h)})),r}},{name:"DMI",shortName:"DMI",calcParams:[14,6],figures:[{key:"pdi",title:"PDI: ",type:"line"},{key:"mdi",title:"MDI: ",type:"line"},{key:"adx",title:"ADX: ",type:"line"},{key:"adxr",title:"ADXR: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,s=0,o=0,a=0,r=0,l=0,c=0,h=0;const u=[];return t.forEach(((e,d)=>{var g,v;const m={},p=null!==(g=t[d-1])&&void 0!==g?g:e,_=p.close,f=e.high,x=e.low,y=f-x,S=Math.abs(f-_),C=Math.abs(_-x),b=f-p.high,w=p.low-x,E=Math.max(Math.max(y,S),C),I=b>0&&b>w?b:0,T=w>0&&w>b?w:0;if(n+=E,s+=I,o+=T,d>=i[0]-1){d>i[0]-1?(a=a-a/i[0]+E,r=r-r/i[0]+I,l=l-l/i[0]+T):(a=n,r=s,l=o);let t=0,e=0;0!==a&&(t=100*r/a,e=100*l/a),m.pdi=t,m.mdi=e;let g=0;e+t!==0&&(g=Math.abs(e-t)/(e+t)*100),c+=g,d>=2*i[0]-2&&(h=d>2*i[0]-2?(h*(i[0]-1)+g)/i[0]:c/i[0],m.adx=h,d>=2*i[0]+i[1]-3&&(m.adxr=((null!==(v=u[d-(i[1]-1)].adx)&&void 0!==v?v:0)+h)/2))}u.push(m)})),u}},{name:"EMV",shortName:"EMV",calcParams:[14,9],figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,s=0;const o=[],a=[];return t.forEach(((e,r)=>{var l,c,h;const u={},d=null!==(l=t[r-1])&&void 0!==l?l:e,g=e.high,v=e.low,m=null!==(c=e.turnover)&&void 0!==c?c:0,p=(g+v)/2,_=(d.high+d.low)/2;let f=0;0!==m&&(f=(p-_)*(g-v)/m),o.push(f),n+=f,r>=i[0]-1&&(u.emv=n,n-=o[r-(i[0]-1)],s+=u.emv,r>=i[0]+i[1]-2&&(u.maEmv=s/i[1],s-=null!==(h=a[r-(i[1]-1)].emv)&&void 0!==h?h:0)),a.push(u)})),a}},{name:"EMA",shortName:"EMA",series:"price",calcParams:[6,12,20],precision:2,shouldOhlc:!0,figures:[{key:"ema1",title:"EMA6: ",type:"line"},{key:"ema2",title:"EMA12: ",type:"line"},{key:"ema3",title:"EMA20: ",type:"line"}],regenerateFigures:t=>t.map(((t,e)=>({key:`ema${e+1}`,title:`EMA${t}: `,type:"line"}))),calc:(t,e)=>{const{calcParams:i,figures:n}=e;let s=0;const o=[];return t.map(((t,e)=>{const a={},r=t.close;return s+=r,i.forEach(((t,i)=>{e>=t-1&&(o[i]=e>t-1?(2*r+(t-1)*o[i])/(t+1):s/t,a[n[i].key]=o[i])})),a}))}},{name:"MTM",shortName:"MTM",calcParams:[12,6],figures:[{key:"mtm",title:"MTM: ",type:"line"},{key:"maMtm",title:"MAMTM: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0;const s=[];return t.forEach(((e,o)=>{var a;const r={};if(o>=i[0]){const l=e.close,c=t[o-i[0]].close;r.mtm=l-c,n+=r.mtm,o>=i[0]+i[1]-1&&(r.maMtm=n/i[1],n-=null!==(a=s[o-(i[1]-1)].mtm)&&void 0!==a?a:0)}s.push(r)})),s}},{name:"MA",shortName:"MA",series:"price",calcParams:[5,10,30,60],precision:2,shouldOhlc:!0,figures:[{key:"ma5",title:"MA5: ",type:"line"},{key:"ma10",title:"MA10: ",type:"line"},{key:"ma30",title:"MA30: ",type:"line"},{key:"ma60",title:"MA60: ",type:"line"}],regenerateFigures:t=>t.map(((t,e)=>({key:`ma${e+1}`,title:`MA${t}: `,type:"line"}))),calc:(t,e)=>{const{calcParams:i,figures:n}=e,s=[];return t.map(((e,o)=>{const a={},r=e.close;return i.forEach(((e,i)=>{var l;s[i]=(null!==(l=s[i])&&void 0!==l?l:0)+r,o>=e-1&&(a[n[i].key]=s[i]/e,s[i]-=t[o-(e-1)].close)})),a}))}},{name:"MACD",shortName:"MACD",calcParams:[12,26,9],figures:[{key:"dif",title:"DIF: ",type:"line"},{key:"dea",title:"DEA: ",type:"line"},{key:"macd",title:"MACD: ",type:"bar",baseValue:0,styles:(t,e,i)=>{var n,s,o,a;const{prev:r,current:l}=t,c=null!==(s=null===(n=r.indicatorData)||void 0===n?void 0:n.macd)&&void 0!==s?s:Number.MIN_SAFE_INTEGER,h=null!==(a=null===(o=l.indicatorData)||void 0===o?void 0:o.macd)&&void 0!==a?a:Number.MIN_SAFE_INTEGER;let u;u=h>0?f(e.styles,"bars[0].upColor",i.bars[0].upColor):h<0?f(e.styles,"bars[0].downColor",i.bars[0].downColor):f(e.styles,"bars[0].noChangeColor",i.bars[0].noChangeColor);return{style:c<h?"stroke":"fill",color:u}}}],calc:(t,e)=>{const i=e.calcParams;let n,s,o=0,a=0,r=0,l=0;const c=Math.max(i[0],i[1]);return t.map(((t,e)=>{const h={},u=t.close;return o+=u,e>=i[0]-1&&(n=e>i[0]-1?(2*u+(i[0]-1)*n)/(i[0]+1):o/i[0]),e>=i[1]-1&&(s=e>i[1]-1?(2*u+(i[1]-1)*s)/(i[1]+1):o/i[1]),e>=c-1&&(a=n-s,h.dif=a,r+=a,e>=c+i[2]-2&&(l=e>c+i[2]-2?(2*a+l*(i[2]-1))/(i[2]+1):r/i[2],h.macd=2*(a-l),h.dea=l)),h}))}},{name:"OBV",shortName:"OBV",calcParams:[30],figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maObv",title:"MAOBV: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,s=0;const o=[];return t.forEach(((e,a)=>{var r,l,c,h;const u=null!==(r=t[a-1])&&void 0!==r?r:e;e.close<u.close?s-=null!==(l=e.volume)&&void 0!==l?l:0:e.close>u.close&&(s+=null!==(c=e.volume)&&void 0!==c?c:0);const d={obv:s};n+=s,a>=i[0]-1&&(d.maObv=n/i[0],n-=null!==(h=o[a-(i[0]-1)].obv)&&void 0!==h?h:0),o.push(d)})),o}},{name:"PVT",shortName:"PVT",figures:[{key:"pvt",title:"PVT: ",type:"line"}],calc:t=>{let e=0;return t.map(((i,n)=>{var s,o;const a={},r=i.close,l=null!==(s=i.volume)&&void 0!==s?s:1,c=(null!==(o=t[n-1])&&void 0!==o?o:i).close;let h=0;const u=c*l;return 0!==u&&(h=(r-c)/u),e+=h,a.pvt=e,a}))}},{name:"PSY",shortName:"PSY",calcParams:[12,6],figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"maPsy",title:"MAPSY: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,s=0;const o=[],a=[];return t.forEach(((e,r)=>{var l,c;const h={},u=(null!==(l=t[r-1])&&void 0!==l?l:e).close,d=e.close-u>0?1:0;o.push(d),n+=d,r>=i[0]-1&&(h.psy=n/i[0]*100,s+=h.psy,r>=i[0]+i[1]-2&&(h.maPsy=s/i[1],s-=null!==(c=a[r-(i[1]-1)].psy)&&void 0!==c?c:0),n-=o[r-(i[0]-1)]),a.push(h)})),a}},{name:"ROC",shortName:"ROC",calcParams:[12,6],figures:[{key:"roc",title:"ROC: ",type:"line"},{key:"maRoc",title:"MAROC: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=[];let s=0;return t.forEach(((e,o)=>{var a,r;const l={};if(o>=i[0]-1){const c=e.close,h=(null!==(a=t[o-i[0]])&&void 0!==a?a:t[o-(i[0]-1)]).close;l.roc=0!==h?(c-h)/h*100:0,s+=l.roc,o>=i[0]-1+i[1]-1&&(l.maRoc=s/i[1],s-=null!==(r=n[o-(i[1]-1)].roc)&&void 0!==r?r:0)}n.push(l)})),n}},A,{name:"SMA",shortName:"SMA",series:"price",calcParams:[12,2],precision:2,figures:[{key:"sma",title:"SMA: ",type:"line"}],shouldOhlc:!0,calc:(t,e)=>{const i=e.calcParams;let n=0,s=0;return t.map(((t,e)=>{const o={},a=t.close;return n+=a,e>=i[0]-1&&(s=e>i[0]-1?(a*i[1]+s*(i[0]-i[1]+1))/(i[0]+1):n/i[0],o.sma=s),o}))}},{name:"KDJ",shortName:"KDJ",calcParams:[9,3,3],figures:[{key:"k",title:"K: ",type:"line"},{key:"d",title:"D: ",type:"line"},{key:"j",title:"J: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=[];return t.forEach(((e,s)=>{var o,a,r,l;const c={},h=e.close;if(s>=i[0]-1){const e=w(t.slice(s-(i[0]-1),s+1),"high","low"),u=e[0],d=e[1],g=u-d,v=(h-d)/(0===g?1:g)*100;c.k=((i[1]-1)*(null!==(a=null===(o=n[s-1])||void 0===o?void 0:o.k)&&void 0!==a?a:50)+v)/i[1],c.d=((i[2]-1)*(null!==(l=null===(r=n[s-1])||void 0===r?void 0:r.d)&&void 0!==l?l:50)+c.k)/i[2],c.j=3*c.k-2*c.d}n.push(c)})),n}},{name:"SAR",shortName:"SAR",series:"price",calcParams:[2,2,20],precision:2,shouldOhlc:!0,figures:[{key:"sar",title:"SAR: ",type:"circle",styles:(t,e,i)=>{var n,s;const{current:o}=t,a=null!==(s=null===(n=o.indicatorData)||void 0===n?void 0:n.sar)&&void 0!==s?s:Number.MIN_SAFE_INTEGER,r=o.kLineData;return{color:a<((null==r?void 0:r.high)+(null==r?void 0:r.low))/2?f(e.styles,"circles[0].upColor",i.circles[0].upColor):f(e.styles,"circles[0].downColor",i.circles[0].downColor)}}}],calc:(t,e)=>{const i=e.calcParams,n=i[0]/100,s=i[1]/100,o=i[2]/100;let a=n,r=-100,l=!1,c=0;return t.map(((e,i)=>{const h=c,u=e.high,d=e.low;if(l){(-100===r||r<u)&&(r=u,a=Math.min(a+s,o)),c=h+a*(r-h);const g=Math.min(t[Math.max(1,i)-1].low,d);c>e.low?(c=r,a=n,r=-100,l=!l):c>g&&(c=g)}else{(-100===r||r>d)&&(r=d,a=Math.min(a+s,o)),c=h+a*(r-h);const n=Math.max(t[Math.max(1,i)-1].high,u);c<e.high?(c=r,a=0,r=-100,l=!l):c<n&&(c=n)}return{sar:c}}))}},{name:"TRIX",shortName:"TRIX",calcParams:[12,9],figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"maTrix",title:"MATRIX: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n,s,o,a=0,r=0,l=0,c=0;const h=[];return t.forEach(((t,e)=>{var u;const d={},g=t.close;if(a+=g,e>=i[0]-1&&(n=e>i[0]-1?(2*g+(i[0]-1)*n)/(i[0]+1):a/i[0],r+=n,e>=2*i[0]-2&&(s=e>2*i[0]-2?(2*n+(i[0]-1)*s)/(i[0]+1):r/i[0],l+=s,e>=3*i[0]-3))){let t,n=0;e>3*i[0]-3?(t=(2*s+(i[0]-1)*o)/(i[0]+1),n=(t-o)/o*100):t=l/i[0],o=t,d.trix=n,c+=n,e>=3*i[0]+i[1]-4&&(d.maTrix=c/i[1],c-=null!==(u=h[e-(i[1]-1)].trix)&&void 0!==u?u:0)}h.push(d)})),h}},F,{name:"VR",shortName:"VR",calcParams:[26,6],figures:[{key:"vr",title:"VR: ",type:"line"},{key:"maVr",title:"MAVR: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,s=0,o=0,a=0;const r=[];return t.forEach(((e,l)=>{var c,h,u,d,g;const v={},m=e.close,p=(null!==(c=t[l-1])&&void 0!==c?c:e).close,_=null!==(h=e.volume)&&void 0!==h?h:0;if(m>p?n+=_:m<p?s+=_:o+=_,l>=i[0]-1){const e=o/2;v.vr=s+e===0?0:(n+e)/(s+e)*100,a+=v.vr,l>=i[0]+i[1]-2&&(v.maVr=a/i[1],a-=null!==(u=r[l-(i[1]-1)].vr)&&void 0!==u?u:0);const c=t[l-(i[0]-1)],h=null!==(d=t[l-i[0]])&&void 0!==d?d:c,m=c.close,p=null!==(g=c.volume)&&void 0!==g?g:0;m>h.close?n-=p:m<h.close?s-=p:o-=p}r.push(v)})),r}},L];function V(t){var e;return null!==(e=R[t])&&void 0!==e?e:null}B.forEach((t=>{R[t.name]=k.extend(t)}));class O{constructor(t){this._instances=new Map,this._chartStore=t}_overrideInstance(t,e){const{shortName:i,series:n,calcParams:s,precision:o,figures:a,minValue:r,maxValue:l,shouldOhlc:c,shouldFormatBigNumber:h,styles:u,extendData:d,regenerateFigures:g,createToolTipDataSource:v,draw:m,calc:p}=e;let _=!1;void 0!==i&&t.setShortName(i)&&(_=!0),void 0!==n&&t.setSeries(n)&&(_=!0);let f=!1;return void 0!==s&&t.setCalcParams(s)&&(_=!0,f=!0),void 0!==a&&t.setFigures(a)&&(_=!0),void 0!==r&&t.setMinValue(r)&&(_=!0),void 0!==l&&t.setMinValue(l)&&(_=!0),void 0!==o&&t.setPrecision(o)&&(_=!0),void 0!==c&&t.setShouldOhlc(c)&&(_=!0),void 0!==h&&t.setShouldFormatBigNumber(h)&&(_=!0),void 0!==u&&t.setStyles(u)&&(_=!0),void 0!==d&&t.setExtendData(d)&&(_=!0),void 0!==g&&t.setRegenerateFigures(g)&&(_=!0),void 0!==v&&t.setCreateToolTipDataSource(v)&&(_=!0),void 0!==m&&t.setDraw(m)&&(_=!0),void 0!==p&&(t.calc=p),[_,f]}async addInstance(t,e,i){var n;const{name:s}=t;let o=this._instances.get(e);if(null!==(n=null==o?void 0:o.has(s))&&void 0!==n&&n)return await Promise.reject(new Error("Duplicate indicators."));void 0===o&&(o=new Map,this._instances.set(e,o));const a=new(V(s));return this._overrideInstance(a,t),i||o.clear(),o.set(s,a),await a.calcIndicator(this._chartStore.getDataList())}getInstances(t){var e;return null!==(e=this._instances.get(t))&&void 0!==e?e:new Map}removeInstance(t,e){let i=!1;if(this._instances.has(t)){const n=this._instances.get(t);void 0!==e?n.has(e)&&(n.delete(e),i=!0):(n.clear(),i=!0),0===n.size&&this._instances.delete(t)}return i}hasInstances(t){return this._instances.has(t)}async calcInstance(t,e){var i;const n=[];if(void 0!==t)if(void 0!==e){const s=this._instances.get(e);if(null!==(i=null==s?void 0:s.has(t))&&void 0!==i&&i){const e=null==s?void 0:s.get(t);n.push(e.calcIndicator(this._chartStore.getDataList()))}}else this._instances.forEach((e=>{if(e.has(t)){const i=null==e?void 0:e.get(t);n.push(i.calcIndicator(this._chartStore.getDataList()))}}));else this._instances.forEach((t=>{t.forEach((t=>{n.push(t.calcIndicator(this._chartStore.getDataList()))}))}));return await Promise.all(n)}getInstanceByPaneId(t,e){var i;if(void 0!==t){const n=this._instances.get(t);return void 0!==e?null!==(i=null==n?void 0:n.get(e))&&void 0!==i?i:null:null!=n?n:null}return this._instances}setSeriesPrecision(t){this._instances.forEach((e=>{e.forEach((e=>{"price"===e.series&&e.setPrecision(t.price,!0),"volume"===e.series&&e.setPrecision(t.volume,!0)}))}))}async override(t,e){const{name:i}=t;let n=new Map;void 0!==e?this._instances.has(e)&&n.set(e,this._instances.get(e)):n=this._instances;const s=[];return n.forEach((e=>{if(e.has(i)){const n=e.get(i);this._overrideInstance(n,t)[1]&&s.push(n.calcIndicator(this._chartStore.getDataList()))}})),await Promise.all(s)}}class N{constructor(t){this._crosshair={},this._chartStore=t}set(t,e){const i=this._chartStore.getDataList(),n=null!=t?t:{};let s,o;void 0!==n.x?(s=this._chartStore.getTimeScaleStore().coordinateToDataIndex(n.x),o=s<0?0:s>i.length-1?i.length-1:s):(s=i.length-1,o=s);const a=i[o],r=this._chartStore.getTimeScaleStore().dataIndexToCoordinate(s),l=this._crosshair.x,c=this._crosshair.y,h=this._crosshair.paneId;return this._crosshair={...n,realX:r,kLineData:a,realDataIndex:s,dataIndex:o},l===n.x&&c===n.y&&h===n.paneId||(null!==a&&this._chartStore.getChart().crosshairChange(this._crosshair),null!=e&&e||this._chartStore.getChart().updatePane(1)),this}recalculate(t){this.set(this._crosshair,t)}get(){return this._crosshair}}class z{constructor(t){this.currentStep=1,this.points=[],this._prevPressedPoint=null,this._prevPressedPoints=[];const{mode:e,extendData:i,styles:n,name:s,totalStep:o,lock:a,needDefaultPointFigure:r,needDefaultXAxisFigure:l,needDefaultYAxisFigure:c,createPointFigures:h,createXAxisFigures:u,createYAxisFigures:d,performEventPressedMove:g,performEventMoveForDrawing:v,onDrawStart:m,onDrawing:p,onDrawEnd:_,onClick:f,onRightClick:x,onPressedMoveStart:y,onPressedMoving:S,onPressedMoveEnd:C,onMouseEnter:b,onMouseLeave:w,onRemoved:E,onSelected:I,onDeselected:T}=t;this.name=s,this.totalStep=void 0===o||o<2?1:o,this.lock=null!=a&&a,this.needDefaultPointFigure=null!=r&&r,this.needDefaultXAxisFigure=null!=l&&l,this.needDefaultYAxisFigure=null!=c&&c,this.mode=null!=e?e:"normal",this.points=[],this.extendData=i,this.styles=null!=n?n:null,this.createPointFigures=null!=h?h:null,this.createXAxisFigures=null!=u?u:null,this.createYAxisFigures=null!=d?d:null,this.performEventPressedMove=null!=g?g:null,this.performEventMoveForDrawing=null!=v?v:null,this.onDrawStart=null!=m?m:null,this.onDrawing=null!=p?p:null,this.onDrawEnd=null!=_?_:null,this.onClick=null!=f?f:null,this.onRightClick=null!=x?x:null,this.onPressedMoveStart=null!=y?y:null,this.onPressedMoving=null!=S?S:null,this.onPressedMoveEnd=null!=C?C:null,this.onMouseEnter=null!=b?b:null,this.onMouseLeave=null!=w?w:null,this.onRemoved=null!=E?E:null,this.onSelected=null!=I?I:null,this.onDeselected=null!=T?T:null}setId(t){return void 0===this.id&&(this.id=t,!0)}setGroupId(t){return void 0===this.groupId&&(this.groupId=t,!0)}setExtendData(t){return t!==this.extendData&&(this.extendData=t,!0)}setStyles(t){return t!==this.styles&&(this.styles=t,!0)}setPoints(t){if(t.length>0){let e;if(this.points=[...t],t.length>=this.totalStep-1?(this.currentStep=-1,e=this.totalStep-1):(this.currentStep=t.length+1,e=t.length),null!==this.performEventMoveForDrawing)for(let t=0;t<e;t++)this.performEventMoveForDrawing({currentStep:t+2,mode:this.mode,points:this.points,performPointIndex:t,performPoint:this.points[t]});return-1===this.currentStep&&null!==this.performEventPressedMove&&this.performEventPressedMove({currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:this.points.length-1,performPoint:this.points[this.points.length-1]}),!0}return!1}setLock(t){return this.lock!==t&&(this.lock=t,!0)}setMode(t){return t!==this.mode&&(this.mode=t,!0)}setOnDrawStartCallback(t){return this.onDrawStart!==t&&(this.onDrawStart=t,!0)}setOnDrawingCallback(t){return this.onDrawing!==t&&(this.onDrawing=t,!0)}setOnDrawEndCallback(t){return this.onDrawEnd!==t&&(this.onDrawEnd=t,!0)}setOnClickCallback(t){return this.onClick!==t&&(this.onClick=t,!0)}setOnRightClickCallback(t){return this.onRightClick!==t&&(this.onRightClick=t,!0)}setOnPressedMoveStartCallback(t){return this.onPressedMoveStart!==t&&(this.onPressedMoveStart=t,!0)}setOnPressedMovingCallback(t){return this.onPressedMoving!==t&&(this.onPressedMoving=t,!0)}setOnPressedMoveEndCallback(t){return this.onPressedMoveEnd!==t&&(this.onPressedMoveEnd=t,!0)}setOnMouseEnterCallback(t){return this.onMouseEnter!==t&&(this.onMouseEnter=t,!0)}setOnMouseLeaveCallback(t){return this.onMouseLeave!==t&&(this.onMouseLeave=t,!0)}setOnRemovedCallback(t){return this.onRemoved!==t&&(this.onRemoved=t,!0)}setOnSelectedCallback(t){return this.onSelected!==t&&(this.onSelected=t,!0)}setOnDeselectedCallback(t){return this.onDeselected!==t&&(this.onDeselected=t,!0)}nextStep(){this.currentStep===this.totalStep-1?this.currentStep=-1:this.currentStep++}isDrawing(){return-1!==this.currentStep}isStart(){return 1===this.currentStep}eventMoveForDrawing(t){var e;const i=this.currentStep-1,n={dataIndex:-1,value:-1};void 0!==t.dataIndex&&(n.dataIndex=t.dataIndex,n.timestamp=t.timestamp),void 0!==t.value&&(n.value=t.value),this.points[i]=n,null===(e=this.performEventMoveForDrawing)||void 0===e||e.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:i,performPoint:n})}eventPressedPointMove(t,e){var i;void 0!==t.dataIndex&&(this.points[e].dataIndex=t.dataIndex,this.points[e].timestamp=t.timestamp),void 0!==t.value&&(this.points[e].value=t.value),null===(i=this.performEventPressedMove)||void 0===i||i.call(this,{currentStep:this.currentStep,points:this.points,mode:this.mode,performPointIndex:e,performPoint:this.points[e]})}startPressedMove(t){this._prevPressedPoint={...t},this._prevPressedPoints=c(this.points)}eventPressedOtherMove(t,e){if(null!==this._prevPressedPoint){let i,n;void 0!==t.dataIndex&&void 0!==this._prevPressedPoint.dataIndex&&(i=t.dataIndex-this._prevPressedPoint.dataIndex),void 0!==t.value&&void 0!==this._prevPressedPoint.value&&(n=t.value-this._prevPressedPoint.value),this.points=this._prevPressedPoints.map((t=>{var s;void 0===t.dataIndex&&void 0!==t.timestamp&&(t.dataIndex=e.timestampToDataIndex(t.timestamp));const o={...t};return void 0!==i&&(o.dataIndex=t.dataIndex+i,o.timestamp=null!==(s=e.dataIndexToTimestamp(o.dataIndex))&&void 0!==s?s:void 0),void 0!==n&&(o.value=t.value+n),o}))}}static extend(t){return class extends z{constructor(){super(t)}}}}function W(t,e){let i=!1;const n=e.coordinates;if(n.length>1)for(let e=1;e<n.length;e++){const s=n[e-1],o=n[e];if(s.x===o.x)i=Math.abs(t.x-s.x)<2;else{const e=X(s,o),n=Y(e,t),a=Math.abs(n-t.y);i=a*a/(e[0]*e[0]+1)<4}if(i)return i}return i}function Y(t,e){return null!=t?e.x*t[0]+t[1]:e.y}function H(t,e,i){return Y(X(t,e),i)}function X(t,e){const i=t.x-e.x;if(0!==i){const n=(t.y-e.y)/i;return[n,t.y-n*t.x]}return null}function $(t,e,i){const{coordinates:n}=e;if(n.length>1){const{style:e="solid",size:s=1,color:o="currentColor",dashedValue:a=[2,2]}=i;t.lineWidth=s,t.strokeStyle=o,"dashed"===e?t.setLineDash(a):t.setLineDash([]),t.beginPath(),t.moveTo(n[0].x,n[0].y);for(let e=1;e<n.length;e++)t.lineTo(n[e].x,n[e].y);t.stroke(),t.closePath()}}const j={name:"line",checkEventOn:W,draw:(t,e,i)=>{$(t,e,i)}};function G(t,e,i){const n=null!=i?i:0,s=[];if(t.length>1)if(t[0].x===t[1].x){const i=0,o=e.height;if(s.push({coordinates:[{x:t[0].x,y:i},{x:t[0].x,y:o}]}),t.length>2){s.push({coordinates:[{x:t[2].x,y:i},{x:t[2].x,y:o}]});const e=t[0].x-t[2].x;for(let a=0;a<n;a++){const n=e*(a+1);s.push({coordinates:[{x:t[0].x+n,y:i},{x:t[0].x+n,y:o}]})}}}else{const i=0,o=e.width,a=X(t[0],t[1]),r=a[0],l=a[1];if(s.push({coordinates:[{x:i,y:i*r+l},{x:o,y:o*r+l}]}),t.length>2){const e=t[2].y-r*t[2].x;s.push({coordinates:[{x:i,y:i*r+e},{x:o,y:o*r+e}]});const a=l-e;for(let t=0;t<n;t++){const e=l+a*(t+1);s.push({coordinates:[{x:i,y:i*r+e},{x:o,y:o*r+e}]})}}}return s}function U(t,e){if(t.length>1){let i;return i=t[0].x===t[1].x&&t[0].y!==t[1].y?t[0].y<t[1].y?{x:t[0].x,y:e.height}:{x:t[0].x,y:0}:t[0].x>t[1].x?{x:0,y:H(t[0],t[1],{x:0,y:t[0].y})}:{x:e.width,y:H(t[0],t[1],{x:e.width,y:t[0].y})},{coordinates:[t[0],i]}}return[]}const Z={name:"simpleAnnotation",createPointFigures:({overlay:t,coordinates:e})=>{var i;let n;v(t.extendData)&&(n=u(t.extendData)?t.extendData(t):null!==(i=t.extendData)&&void 0!==i?i:"");const s=e[0].x,o=e[0].y-6,a=o-50,r=a-5;return[{type:"line",attrs:{coordinates:[{x:s,y:o},{x:s,y:a}]},ignoreEvent:!0},{type:"polygon",attrs:{coordinates:[{x:s,y:a},{x:s-4,y:r},{x:s+4,y:r}]},ignoreEvent:!0},{type:"rectText",attrs:{x:s,y:r,text:null!=n?n:"",align:"center",baseline:"bottom"},ignoreEvent:!0}]}},q={name:"simpleTag",createPointFigures:({bounding:t,coordinates:e})=>({type:"line",attrs:{coordinates:[{x:0,y:e[0].y},{x:t.width,y:e[0].y}]},ignoreEvent:!0}),createYAxisFigures:({overlay:t,coordinates:e,bounding:i,yAxis:n,precision:s})=>{var o,a;let r,l,c;return null!==(o=null==n?void 0:n.isFromZero())&&void 0!==o&&o?(r="left",l=0):(r="right",l=i.width),v(t.extendData)&&(c=u(t.extendData)?t.extendData(t):null!==(a=t.extendData)&&void 0!==a?a:""),v(c)||(c=y(t.points[0].value,s.price)),{type:"rectText",attrs:{x:l,y:e[0].y,text:null!=c?c:"",align:r,baseline:"middle"}}}},K={};function J(t){var e;return null!==(e=K[t])&&void 0!==e?e:null}function Q(t){const e={width:0,height:0,left:0,right:0,top:0,bottom:0};return void 0!==t&&l(e,t),e}[{name:"fibonacciLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e,overlay:i,precision:n})=>{const s=i.points;if(t.length>0){const i=[],o=[],a=0,r=e.width;if(t.length>1){const e=[1,.786,.618,.5,.382,.236,0],l=t[0].y-t[1].y,c=s[0].value-s[1].value;e.forEach((e=>{const h=t[1].y+l*e,u=(s[1].value+c*e).toFixed(n.price);i.push({coordinates:[{x:a,y:h},{x:r,y:h}]}),o.push({x:a,y:h,text:`${u} (${(100*e).toFixed(1)}%)`,baseline:"bottom"})}))}return[{type:"line",attrs:i},{type:"text",isCheckEvent:!1,attrs:o}]}return[]}},{name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>{const i={x:0,y:t[0].y};return void 0!==t[1]&&t[0].x<t[1].x&&(i.x=e.width),[{type:"line",attrs:{coordinates:[t[0],i]}}]},performEventPressedMove:({points:t,performPoint:e})=>{t[0].value=e.value,t[1].value=e.value},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].value=i.value)}},{name:"horizontalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{const e=[];return 2===t.length&&e.push({coordinates:t}),[{type:"line",attrs:e}]},performEventPressedMove:({points:t,performPoint:e})=>{t[0].value=e.value,t[1].value=e.value},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].value=i.value)}},{name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:{coordinates:[{x:0,y:t[0].y},{x:e.width,y:t[0].y}]}}]},{name:"parallelStraightLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:G(t,e)}]},{name:"priceChannelLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:G(t,e,1)}]},{name:"priceLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e,precision:i,overlay:n})=>{const{value:s}=n.points[0];return[{type:"line",attrs:{coordinates:[t[0],{x:e.width,y:t[0].y}]}},{type:"text",isCheck:!1,attrs:{x:t[0].x,y:t[0].y,text:s.toFixed(i.price),baseline:"bottom"}}]}},{name:"rayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:U(t,e)}]},{name:"segment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>2===t.length?[{type:"line",attrs:{coordinates:t}}]:[]},{name:"straightLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>2===t.length?t[0].x===t[1].x?[{type:"line",attrs:{coordinates:[{x:t[0].x,y:0},{x:t[0].x,y:e.height}]}}]:[{type:"line",attrs:{coordinates:[{x:0,y:H(t[0],t[1],{x:0,y:t[0].y})},{x:e.width,y:H(t[0],t[1],{x:e.width,y:t[0].y})}]}}]:[]},{name:"verticalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>{if(2===t.length){const i={x:t[0].x,y:0};return t[0].y<t[1].y&&(i.y=e.height),[{type:"line",attrs:{coordinates:[t[0],i]}}]}return[]},performEventPressedMove:({points:t,performPoint:e})=>{t[0].timestamp=e.timestamp,t[0].dataIndex=e.dataIndex,t[1].timestamp=e.timestamp,t[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].timestamp=i.timestamp,e[0].dataIndex=i.dataIndex)}},{name:"verticalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>2===t.length?[{type:"line",attrs:{coordinates:t}}]:[],performEventPressedMove:({points:t,performPoint:e})=>{t[0].timestamp=e.timestamp,t[0].dataIndex=e.dataIndex,t[1].timestamp=e.timestamp,t[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].timestamp=i.timestamp,e[0].dataIndex=i.dataIndex)}},{name:"verticalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:{coordinates:[{x:t[0].x,y:0},{x:t[0].x,y:e.height}]}}]},Z,q].forEach((t=>{K[t.name]=z.extend(t)}));const tt={CANDLE:"candle_pane",INDICATOR:"indcator_pane_",XAXIS:"xaxis_pane"};class et{constructor(t,e,i,n,s){this._yAxisWidget=null,this._separatorWidget=null,this._axis=this.createAxisComponent(),this._bounding=Q(),this._options={minHeight:30,dragEnabled:!0,gap:{top:.2,bottom:.1}},this._chart=e,this._id=i,this._topPane=null!=n?n:null,this._bottomPane=null!=s?s:null,this._init(t)}_init(t){this._container=t,this._seriesContiainer=n("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"}),this._separatorWidget=this.createSeparatorWidget(t);const e=t.lastChild;null!==e?t.insertBefore(this._seriesContiainer,e):t.appendChild(this._seriesContiainer),this._mainWidget=this.createMainWidget(this._seriesContiainer),this._yAxisWidget=this.creatYAxisWidget(this._seriesContiainer)}getContainer(){return this._seriesContiainer}getId(){return this._id}setOptions(t){return l(this._options,t),this}getOptions(){return this._options}getChart(){return this._chart}getAxisComponent(){return this._axis}setBounding(t,e,i){var n,s,o;if(l(this._bounding,t),void 0!==t.height){const e=this.getChart().getStyles().separator.size,i={height:t.height-e};this._mainWidget.setBounding(i),null===(n=this._yAxisWidget)||void 0===n||n.setBounding(i)}return void 0!==e&&(this._mainWidget.setBounding(e),null===(s=this._separatorWidget)||void 0===s||s.setBounding(e)),void 0!==i&&(null===(o=this._yAxisWidget)||void 0===o||o.setBounding(i)),this}getTopPane(){return this._topPane}setTopPane(t){return this._topPane=t,this}getBottomPane(){return this._bottomPane}setBottomPane(t){return this._bottomPane=t,this}getBounding(){return this._bounding}getMainWidget(){return this._mainWidget}getYAxisWidget(){return this._yAxisWidget}getSeparatorWidget(){return this._separatorWidget}update(t){var e,i;this._bounding.width!==this._seriesContiainer.offsetWidth&&(this._seriesContiainer.style.width=`${this._bounding.width}px`);const n=this._mainWidget.getBounding().height;n!==this._seriesContiainer.offsetHeight&&(this._seriesContiainer.style.height=`${n}px`);const s=null!=t?t:3;this._mainWidget.update(s),null===(e=this._yAxisWidget)||void 0===e||e.update(s),null===(i=this._separatorWidget)||void 0===i||i.update(s)}getImage(t){const{width:e,height:i}=this._bounding,s=n("canvas",{width:`${e}px`,height:`${i}px`,boxSizing:"border-box"}),a=s.getContext("2d"),r=o(s);s.width=e*r,s.height=i*r,a.scale(r,r);let l=0;if(null!=this._separatorWidget){const t=this.getChart().getStyles().separator.size;l=t,a.drawImage(this._separatorWidget.getImage(),0,0,e,t)}const c=this._mainWidget.getBounding();if(a.drawImage(this._mainWidget.getImage(t),c.left,l,c.width,c.height),null!==this._yAxisWidget){const e=this._yAxisWidget.getBounding();a.drawImage(this._yAxisWidget.getImage(t),e.left,l,e.width,e.height)}return s}destroy(){this._container.removeChild(this._seriesContiainer),null!==this._separatorWidget&&this._container.removeChild(this._separatorWidget.getContainer())}createSeparatorWidget(t){return null}creatYAxisWidget(t){return null}}class it{constructor(t){this._instances=new Map,this._progressInstanceInfo=null,this._pressedInstanceInfo={paneId:"",instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1},this._hoverInstanceInfo={paneId:"",instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1},this._clickInstanceInfo={paneId:"",instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1},this._chartStore=t}_overrideInstance(t,e){const{id:i,groupId:n,points:s,styles:o,lock:a,mode:r,extendData:l,onDrawStart:c,onDrawing:h,onDrawEnd:u,onClick:d,onRightClick:g,onPressedMoveStart:v,onPressedMoving:m,onPressedMoveEnd:p,onMouseEnter:_,onMouseLeave:f,onRemoved:x,onSelected:y,onDeselected:S}=e;let C=!1;return void 0!==i&&t.setId(i),void 0!==n&&t.setGroupId(n),void 0!==s&&t.setPoints(s)&&(C=!0),void 0!==o&&t.setStyles(o)&&(C=!0),void 0!==a&&t.setLock(a),void 0!==r&&t.setMode(r),void 0!==l&&t.setExtendData(l)&&(C=!0),void 0!==c&&t.setOnDrawStartCallback(c),void 0!==h&&t.setOnDrawingCallback(h),void 0!==u&&t.setOnDrawEndCallback(u),void 0!==d&&t.setOnClickCallback(d),void 0!==g&&t.setOnRightClickCallback(g),void 0!==v&&t.setOnPressedMoveStartCallback(v),void 0!==m&&t.setOnPressedMovingCallback(m),void 0!==p&&t.setOnPressedMoveEndCallback(p),void 0!==_&&t.setOnMouseEnterCallback(_),void 0!==f&&t.setOnMouseLeaveCallback(f),void 0!==x&&t.setOnRemovedCallback(x),void 0!==y&&t.setOnSelectedCallback(y),void 0!==S&&t.setOnDeselectedCallback(S),C}getInstanceById(t){for(const e of this._instances){const i=e[1].find((e=>e.id===t));if(void 0!==i)return i}return null!==this._progressInstanceInfo&&this._progressInstanceInfo.instance.id===t?this._progressInstanceInfo.instance:null}addInstance(t,e,n){var s,o,a,r;const l=null!==(s=t.id)&&void 0!==s?s:i("overlay_");if(null===this.getInstanceById(l)){const i=new(J(t.name)),s=null!==(o=t.groupId)&&void 0!==o?o:l;return t.id=l,t.groupId=s,this._overrideInstance(i,t),i.isDrawing()?this._progressInstanceInfo={paneId:e,instance:i,appointPaneFlag:n}:(this._instances.has(e)||this._instances.set(e,[]),null===(a=this._instances.get(e))||void 0===a||a.push(i)),null===(r=i.onDrawStart)||void 0===r||r.call(i,{overlay:i}),this._chartStore.getChart().updatePane(1,e),l}return null}getProgressInstanceInfo(){return this._progressInstanceInfo}progressInstanceComplete(){var t;if(null!==this._progressInstanceInfo){const{instance:e,paneId:i}=this._progressInstanceInfo;e.isDrawing()||(this._instances.has(i)||this._instances.set(i,[]),null===(t=this._instances.get(i))||void 0===t||t.push(e),this._progressInstanceInfo=null)}}updateProgressInstanceInfo(t,e){null!==this._progressInstanceInfo&&(void 0!==e&&e&&(this._progressInstanceInfo.appointPaneFlag=e),this._progressInstanceInfo.appointPaneFlag||(this._progressInstanceInfo.paneId=t))}getInstances(t){var e;if(void 0===t){let t=[];return this._instances.forEach((e=>{t=t.concat(e)})),t}return null!==(e=this._instances.get(t))&&void 0!==e?e:[]}override(t){const{id:e,groupId:i,name:n}=t;let s=!1;if(void 0!==e){const i=this.getInstanceById(e);null!==i&&this._overrideInstance(i,t)&&(s=!0)}else if(this._instances.forEach((e=>{e.forEach((e=>{(void 0!==n&&e.name===n||void 0!==i&&e.groupId===i||void 0===n&&void 0===i)&&this._overrideInstance(e,t)&&(s=!0)}))})),null!==this._progressInstanceInfo){const e=this._progressInstanceInfo.instance;(void 0!==n&&e.name===n||void 0!==i&&e.groupId===i||void 0===n&&void 0===i)&&this._overrideInstance(e,t)&&(s=!0)}s&&this._chartStore.getChart().updatePane(1)}removeInstance(t){var e;const i=(t,e)=>{if(void 0!==t.id){if(e.id!==t.id)return!1}else if(void 0!==t.groupId){if(e.groupId!==t.groupId)return!1}else if(void 0!==t.name&&e.name!==t.name)return!1;return!0},n=[];if(null!==this._progressInstanceInfo){const s=this._progressInstanceInfo.instance;(void 0===t||void 0!==t&&i(t,s))&&(n.push(this._progressInstanceInfo.paneId),null===(e=s.onRemoved)||void 0===e||e.call(s,{overlay:s}),this._progressInstanceInfo=null)}if(void 0!==t){const e=new Map;for(const s of this._instances){const o=s[1].filter((e=>{var o;return!i(t,e)||(n.includes(s[0])||n.push(s[0]),null===(o=e.onRemoved)||void 0===o||o.call(e,{overlay:e}),!1)}));o.length>0&&e.set(s[0],o)}this._instances=e}else this._instances.forEach(((t,e)=>{n.push(e),t.forEach((t=>{var e;null===(e=t.onRemoved)||void 0===e||e.call(t,{overlay:t})}))})),this._instances.clear();if(n.length>0){const t=this._chartStore.getChart();n.forEach((e=>{t.updatePane(1,e)}))}}setPressedInstanceInfo(t){this._pressedInstanceInfo=t}getPressedInstanceInfo(){return this._pressedInstanceInfo}setHoverInstanceInfo(t,e){var i,n,s,o,a;const{instance:r,figureType:l,figureIndex:c}=this._hoverInstanceInfo;(null==r?void 0:r.id)===(null===(i=t.instance)||void 0===i?void 0:i.id)&&l===t.figureType&&c===t.figureIndex||(this._hoverInstanceInfo=t,(null==r?void 0:r.id)!==(null===(n=t.instance)||void 0===n?void 0:n.id)&&(null===(s=null==r?void 0:r.onMouseLeave)||void 0===s||s.call(r,{overlay:r,...e}),null===(a=null===(o=t.instance)||void 0===o?void 0:o.onMouseEnter)||void 0===a||a.call(o,{overlay:t.instance,...e})))}getHoverInstanceInfo(){return this._hoverInstanceInfo}setClickInstanceInfo(t,e){var i,n,s,o,a,r,l,c,h;const{paneId:u,instance:d,figureType:g,figureIndex:v}=this._clickInstanceInfo;if(null!==(n=null===(i=t.instance)||void 0===i?void 0:i.isDrawing())&&void 0!==n&&n&&(null===(o=null===(s=t.instance)||void 0===s?void 0:s.onClick)||void 0===o||o.call(s,{overlay:t.instance,...e})),((null==d?void 0:d.id)!==(null===(a=t.instance)||void 0===a?void 0:a.id)||g!==t.figureType||v!==t.figureIndex)&&(this._clickInstanceInfo=t,(null==d?void 0:d.id)!==(null===(r=t.instance)||void 0===r?void 0:r.id))){null===(l=null==d?void 0:d.onDeselected)||void 0===l||l.call(d,{overlay:d,...e}),null===(h=null===(c=t.instance)||void 0===c?void 0:c.onSelected)||void 0===h||h.call(c,{overlay:t.instance,...e});const i=this._chartStore.getChart();i.updatePane(1,t.paneId),u!==t.paneId&&i.updatePane(1,u),i.updatePane(1,tt.XAXIS)}}getClickInstanceInfo(){return this._clickInstanceInfo}isEmpty(){return 0===this._instances.size&&null===this._progressInstanceInfo}isDrawing(){var t,e;return null!==this._progressInstanceInfo&&null!==(e=null===(t=this._progressInstanceInfo)||void 0===t?void 0:t.instance.isDrawing())&&void 0!==e&&e}}class nt{constructor(){this._callbacks=[]}subscribe(t){var e;(null!==(e=this._callbacks.indexOf(t))&&void 0!==e?e:-1)<0&&this._callbacks.push(t)}unsubscribe(t){var e;if(void 0!==t){const i=null!==(e=this._callbacks.indexOf(t))&&void 0!==e?e:-1;i>-1&&this._callbacks.splice(i,1)}else this._callbacks=[]}execute(t){this._callbacks.forEach((e=>{e(t)}))}isEmpty(){return 0===this._callbacks.length}}class st{constructor(){this._actions=new Map}execute(t,e){var i;null===(i=this._actions.get(t))||void 0===i||i.execute(e)}subscribe(t,e){var i;this._actions.has(t)||this._actions.set(t,new nt),null===(i=this._actions.get(t))||void 0===i||i.subscribe(e)}unsubscribe(t,e){const i=this._actions.get(t);void 0!==i&&(i.unsubscribe(e),i.isEmpty()&&this._actions.delete(t))}has(t){const e=this._actions.get(t);return void 0!==e&&!e.isEmpty()}}const ot={light:{},dark:{grid:{horizontal:{color:"#292929"},vertical:{color:"#292929"}},candle:{priceMark:{high:{color:"#929AA5"},low:{color:"#929AA5"}},tooltip:{rect:{color:"rgba(10, 10, 10, .6)",borderColor:"rgba(10, 10, 10, .6)"},text:{color:"#929AA5"}}},indicator:{tooltip:{text:{color:"#929AA5"}}},xAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},yAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},separator:{color:"#333333"},crosshair:{horizontal:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}},vertical:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}}}}};function at(t){var e;return null!==(e=ot[t])&&void 0!==e?e:null}class rt{constructor(t,e){this._styles={grid:{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]}},candle:{type:"candle_solid",bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#999999"},area:{lineSize:2,lineColor:"#2196F3",value:"close",backgroundColor:[{offset:0,color:"rgba(33, 150, 243, 0.01)"},{offset:1,color:"rgba(33, 150, 243, 0.2)"}]},priceMark:{show:!0,high:{show:!0,color:"#76808F",textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},low:{show:!0,color:"#76808F",textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},last:{show:!0,upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888",line:{show:!0,style:"dashed",dashedValue:[4,4],size:1},text:{show:!0,style:"fill",size:12,paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],color:"#FFFFFF",family:"Helvetica Neue",weight:"normal",borderRadius:2}}},tooltip:{showRule:"always",showType:"standard",custom:null,defaultValue:"n/a",rect:{paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:6,offsetLeft:8,offsetTop:8,offsetRight:8,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",color:"#FEFEFE"},text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginLeft:8,marginTop:6,marginRight:8,marginBottom:0}}},indicator:{ohlc:{upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"},bars:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"}],lines:[{style:"solid",size:1,dashedValue:[2,2],color:"#FF9600"},{style:"solid",size:1,dashedValue:[2,2],color:"#9D65C9"},{style:"solid",size:1,dashedValue:[2,2],color:"#2196F3"},{style:"solid",size:1,dashedValue:[2,2],color:"#E11D74"},{style:"solid",size:1,dashedValue:[2,2],color:"#01C5C4"}],circles:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"}],lastValueMark:{show:!1,text:{show:!1,style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderRadius:2}},tooltip:{showRule:"always",showType:"standard",showName:!0,showParams:!0,defaultValue:"n/a",text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginTop:6,marginRight:8,marginBottom:0,marginLeft:8}}},xAxis:{show:!0,size:"auto",axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:4},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},yAxis:{show:!0,size:"auto",type:"normal",position:"right",inside:!1,reverse:!1,axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:4},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},separator:{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:"rgba(33, 150, 243, 0.08)"},crosshair:{show:!0,horizontal:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:"#76808F"},text:{show:!0,style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:"#686D76",borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#686D76"}},vertical:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:"#76808F"},text:{show:!0,style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:"#686D76",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#686D76"}}},overlay:{point:{color:"#3f8aa9",borderColor:"rgba(63, 138, 169, 0.35)",borderSize:1,radius:5,activeColor:"#3f8aa9",activeBorderColor:"rgba(63, 138, 169, 0.35)",activeBorderSize:3,activeRadius:5},line:{style:"solid",color:"#3f8aa9",size:1,dashedValue:[2,2]},rect:{style:"fill",color:"rgba(63, 138, 169, 0.25)",borderColor:"#3f8aa9",borderSize:1,borderRadius:0,borderStyle:"solid",borderDashedValue:[2,2]},polygon:{style:"fill",color:"#3f8aa9",borderColor:"#3f8aa9",borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},circle:{style:"fill",color:"rgba(63, 138, 169, 0.25)",borderColor:"#3f8aa9",borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},arc:{style:"solid",color:"#3f8aa9",size:1,dashedValue:[2,2]},text:{color:"#3f8aa9",size:12,family:"Helvetica Neue",weight:"normal"},rectText:{style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:"#3f8aa9",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#3f8aa9"}}},this._customApi={formatDate:x,formatBigNumber:S},this._locale="en-US",this._precision={price:2,volume:0},this._dataList=[],this._dragPaneFlag=!1,this._timeScaleStore=new M(this),this._indicatorStore=new O(this),this._overlayStore=new it(this),this._crosshairStore=new N(this),this._actionStore=new st,this._visibleDataList=[],this._chart=t,this.setOptions(e)}adjustVisibleDataList(){this._visibleDataList=[];const{from:t,to:e}=this._timeScaleStore.getVisibleRange();for(let i=t;i<e;i++){const t=this._dataList[i],e=this._timeScaleStore.dataIndexToCoordinate(i);this._visibleDataList.push({dataIndex:i,x:e,data:t})}}setOptions(t){if(void 0!==t){const{locale:e,timezone:i,styles:n,customApi:s}=t;void 0!==e&&(this._locale=e),void 0!==i&&this._timeScaleStore.setTimezone(i),void 0!==n&&(m(n)?l(this._styles,at(n)):l(this._styles,n)),void 0!==s&&l(this._customApi,s)}return this}getStyles(){return this._styles}getLocale(){return this._locale}getCustomApi(){return this._customApi}getPrecision(){return this._precision}setPrecision(t){return this._precision=t,this._indicatorStore.setSeriesPrecision(t),this}getDataList(){return this._dataList}getVisibleDataList(){return this._visibleDataList}addData(t,e,i){if(h(t)){this._timeScaleStore.setLoading(!1),this._timeScaleStore.setMore(null==i||i);const e=0===this._dataList.length;this._dataList=t.concat(this._dataList),e&&this._timeScaleStore.resetOffsetRightDistance(),this._timeScaleStore.adjustVisibleRange()}else{if(e>=this._dataList.length){this._dataList.push(t);let e=this._timeScaleStore.getOffsetRightBarCount();e<0&&this._timeScaleStore.setOffsetRightBarCount(--e),this._timeScaleStore.adjustVisibleRange()}else this._dataList[e]=t,this.adjustVisibleDataList()}this._crosshairStore.recalculate(!0)}clearDataList(){this._dataList=[],this._visibleDataList=[],this._timeScaleStore.clear()}getTimeScaleStore(){return this._timeScaleStore}getIndicatorStore(){return this._indicatorStore}getOverlayStore(){return this._overlayStore}getCrosshairStore(){return this._crosshairStore}getActionStore(){return this._actionStore}getChart(){return this._chart}getDragPaneFlag(){return this._dragPaneFlag}setDragPaneFlag(t){return this._dragPaneFlag=t,this}}function lt(){var t;return"undefined"!=typeof window&&(null!==(t=window.navigator.userAgent.toLowerCase().indexOf("firefox"))&&void 0!==t?t:-1)>-1}function ct(){return"undefined"!=typeof window&&/iPhone|iPad|iPod/.test(window.navigator.platform)}class ht{constructor(t,e,i){this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartCoordinate=null,this._touchMoveStartCoordinate=null,this._touchMoveExceededManhattanDistance=!1,this._cancelClick=!1,this._cancelTap=!1,this._unsubscribeOutsideMouseEvents=null,this._unsubscribeOutsideTouchEvents=null,this._unsubscribeMobileSafariEvents=null,this._unsubscribeMousemove=null,this._unsubscribeMouseWheel=null,this._unsubscribeContextMenu=null,this._unsubscribeRootMouseEvents=null,this._unsubscribeRootTouchEvents=null,this._startPinchMiddleCoordinate=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventTouchDragProcess=!1,this._mousePressed=!1,this._lastTouchEventTimeStamp=0,this._activeTouchId=null,this._acceptMouseLeave=!ct(),this._onFirefoxOutsideMouseUp=t=>{this._mouseUpHandler(t)},this._onMobileSafariDoubleClick=t=>{if(this._firesTouchEvents(t)){const e=this._makeCompatEvent(t);if(++this._tapCount,null!==this._tapTimeoutId&&this._tapCount>1){const{manhattanDistance:i}=this._mouseTouchMoveWithDownInfo(gt(t),this._tapCoordinate);i<30&&!this._cancelTap&&this._processTouchEvent(e,this._handler.doubleTapEvent),this._resetTapTimeout()}}else{const e=this._makeCompatEvent(t);if(++this._clickCount,null!==this._clickTimeoutId&&this._clickCount>1){const{manhattanDistance:i}=this._mouseTouchMoveWithDownInfo(gt(t),this._clickCoordinate);i<5&&!this._cancelClick&&this._processMouseEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}}},this._target=t,this._handler=e,this._options=i,this._init()}destroy(){null!==this._unsubscribeOutsideMouseEvents&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),null!==this._unsubscribeOutsideTouchEvents&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeMouseWheel&&(this._unsubscribeMouseWheel(),this._unsubscribeMouseWheel=null),null!==this._unsubscribeContextMenu&&(this._unsubscribeContextMenu(),this._unsubscribeContextMenu=null),null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),null!==this._unsubscribeMobileSafariEvents&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()}_mouseEnterHandler(t){var e,i,n;null===(e=this._unsubscribeMousemove)||void 0===e||e.call(this),null===(i=this._unsubscribeMouseWheel)||void 0===i||i.call(this),null===(n=this._unsubscribeContextMenu)||void 0===n||n.call(this);const s=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=()=>{this._target.removeEventListener("mousemove",s)},this._target.addEventListener("mousemove",s);const o=this._mouseWheelHandler.bind(this);this._unsubscribeMouseWheel=()=>{this._target.removeEventListener("wheel",o)},this._target.addEventListener("wheel",o,{passive:!1});const a=this._contextMenuHandler.bind(this);if(this._unsubscribeContextMenu=()=>{this._target.removeEventListener("contextmenu",a)},this._target.addEventListener("contextmenu",a,{passive:!1}),this._firesTouchEvents(t))return;const r=this._makeCompatEvent(t);this._processMouseEvent(r,this._handler.mouseEnterEvent),this._acceptMouseLeave=!0}_resetClickTimeout(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_resetTapTimeout(){null!==this._tapTimeoutId&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_mouseMoveHandler(t){if(this._mousePressed||null!==this._touchMoveStartCoordinate)return;if(this._firesTouchEvents(t))return;const e=this._makeCompatEvent(t);this._processMouseEvent(e,this._handler.mouseMoveEvent),this._acceptMouseLeave=!0}_mouseWheelHandler(t){if(Math.abs(t.deltaX)>Math.abs(t.deltaY)){if(void 0===this._handler.mouseWheelHorizontalEvent)return;if(dt(t),0===Math.abs(t.deltaX))return;this._handler.mouseWheelHorizontalEvent(-t.deltaX)}else{if(void 0===this._handler.mouseWheelVerticalEvent)return;let e=-t.deltaY/100;if(0===e)return;switch(dt(t),t.deltaMode){case t.DOM_DELTA_PAGE:e*=120;break;case t.DOM_DELTA_LINE:e*=32}if(0!==e){const i=Math.sign(e)*Math.min(1,Math.abs(e)),n=this._makeCompatEvent(t);this._handler.mouseWheelVerticalEvent({x:n.x,y:n.y},i)}}}_contextMenuHandler(t){dt(t)}_touchMoveHandler(t){const e=mt(t.changedTouches,this._activeTouchId);if(null===e)return;if(this._lastTouchEventTimeStamp=vt(t),null!==this._startPinchMiddleCoordinate)return;if(this._preventTouchDragProcess)return;this._pinchPrevented=!0;const i=this._mouseTouchMoveWithDownInfo(gt(e),this._touchMoveStartCoordinate),{xOffset:n,yOffset:s,manhattanDistance:o}=i;if(this._touchMoveExceededManhattanDistance||!(o<5)){if(!this._touchMoveExceededManhattanDistance){const t=.5*n,e=s>=t&&!this._options.treatVertTouchDragAsPageScroll(),i=t>s&&!this._options.treatHorzTouchDragAsPageScroll();e||i||(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}if(!this._preventTouchDragProcess){const i=this._makeCompatEvent(t,e);this._processTouchEvent(i,this._handler.touchMoveEvent)}}}_mouseMoveWithDownHandler(t){if(0!==t.button)return;const e=this._mouseTouchMoveWithDownInfo(gt(t),this._mouseMoveStartCoordinate),{manhattanDistance:i}=e;if(i>=5&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick){const e=this._makeCompatEvent(t);this._processMouseEvent(e,this._handler.pressedMouseMoveEvent)}}_mouseTouchMoveWithDownInfo(t,e){const i=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);return{xOffset:i,yOffset:n,manhattanDistance:i+n}}_touchEndHandler(t){let e=mt(t.changedTouches,this._activeTouchId);if(null===e&&0===t.touches.length&&(e=t.changedTouches[0]),null===e)return;this._activeTouchId=null,this._lastTouchEventTimeStamp=vt(t),this._clearLongTapTimeout(),this._touchMoveStartCoordinate=null,null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);const i=this._makeCompatEvent(t,e);if(this._processTouchEvent(i,this._handler.touchEndEvent),++this._tapCount,null!==this._tapTimeoutId&&this._tapCount>1){const{manhattanDistance:t}=this._mouseTouchMoveWithDownInfo(gt(e),this._tapCoordinate);t<30&&!this._cancelTap&&this._processTouchEvent(i,this._handler.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processTouchEvent(i,this._handler.tapEvent),void 0!==this._handler.tapEvent&&dt(t));0===this._tapCount&&dt(t),0===t.touches.length&&this._longTapActive&&(this._longTapActive=!1,dt(t))}_mouseUpHandler(t){if(0!==t.button)return;const e=this._makeCompatEvent(t);if(this._mouseMoveStartCoordinate=null,this._mousePressed=!1,null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),lt()){this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp)}if(!this._firesTouchEvents(t))if(this._processMouseEvent(e,this._handler.mouseUpEvent),++this._clickCount,null!==this._clickTimeoutId&&this._clickCount>1){const{manhattanDistance:i}=this._mouseTouchMoveWithDownInfo(gt(t),this._clickCoordinate);i<5&&!this._cancelClick&&this._processMouseEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processMouseEvent(e,this._handler.mouseClickEvent)}_clearLongTapTimeout(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}_touchStartHandler(t){if(null!==this._activeTouchId)return;const e=t.changedTouches[0];this._activeTouchId=e.identifier,this._lastTouchEventTimeStamp=vt(t);const i=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartCoordinate=gt(e),null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{const e=this._touchMoveHandler.bind(this),n=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=()=>{i.removeEventListener("touchmove",e),i.removeEventListener("touchend",n)},i.addEventListener("touchmove",e,{passive:!1}),i.addEventListener("touchend",n,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),240)}const n=this._makeCompatEvent(t,e);this._processTouchEvent(n,this._handler.touchStartEvent),null===this._tapTimeoutId&&(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),500),this._tapCoordinate=gt(e))}_mouseDownHandler(t){if(2===t.button){dt(t);const e=this._makeCompatEvent(t);return void this._processMouseEvent(e,this._handler.mouseRightClickEvent)}if(0!==t.button)return;const e=this._target.ownerDocument.documentElement;lt()&&e.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartCoordinate=gt(t),null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{const t=this._mouseMoveWithDownHandler.bind(this),i=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=()=>{e.removeEventListener("mousemove",t),e.removeEventListener("mouseup",i)},e.addEventListener("mousemove",t),e.addEventListener("mouseup",i)}if(this._mousePressed=!0,this._firesTouchEvents(t))return;const i=this._makeCompatEvent(t);this._processMouseEvent(i,this._handler.mouseDownEvent),null===this._clickTimeoutId&&(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500),this._clickCoordinate=gt(t))}_init(){this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));{const t=this._target.ownerDocument,e=t=>{null!=this._handler.mouseDownOutsideEvent&&(t.composed&&this._target.contains(t.composedPath()[0])||null!==t.target&&this._target.contains(t.target)||this._handler.mouseDownOutsideEvent())};this._unsubscribeOutsideTouchEvents=()=>{t.removeEventListener("touchstart",e)},this._unsubscribeOutsideMouseEvents=()=>{t.removeEventListener("mousedown",e)},t.addEventListener("mousedown",e),t.addEventListener("touchstart",e,{passive:!0})}ct()&&(this._unsubscribeMobileSafariEvents=()=>{this._target.removeEventListener("dblclick",this._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),function(t){if("undefined"==typeof window||void 0===window.chrome)return;t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1}))}(this._target),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",(()=>{}),{passive:!1})}_initPinch(){void 0===this._handler.pinchStartEvent&&void 0===this._handler.pinchEvent&&void 0===this._handler.pinchEndEvent||(this._target.addEventListener("touchstart",(t=>this._checkPinchState(t.touches)),{passive:!0}),this._target.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this._startPinchMiddleCoordinate&&void 0!==this._handler.pinchEvent){const e=ut(t.touches[0],t.touches[1])/this._startPinchDistance;this._handler.pinchEvent(this._startPinchMiddleCoordinate,e),dt(t)}}),{passive:!1}),this._target.addEventListener("touchend",(t=>{this._checkPinchState(t.touches)})))}_checkPinchState(t){1===t.length&&(this._pinchPrevented=!1),2!==t.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)}_startPinch(t){const e=(i=this._target,null!==(n=i.getBoundingClientRect())&&void 0!==n?n:{left:0,top:0});var i,n;this._startPinchMiddleCoordinate={x:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,y:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this._startPinchDistance=ut(t[0],t[1]),void 0!==this._handler.pinchStartEvent&&this._handler.pinchStartEvent(),this._clearLongTapTimeout()}_stopPinch(){null!==this._startPinchMiddleCoordinate&&(this._startPinchMiddleCoordinate=null,void 0!==this._handler.pinchEndEvent&&this._handler.pinchEndEvent())}_mouseLeaveHandler(t){var e,i,n;if(null===(e=this._unsubscribeMousemove)||void 0===e||e.call(this),null===(i=this._unsubscribeMouseWheel)||void 0===i||i.call(this),null===(n=this._unsubscribeContextMenu)||void 0===n||n.call(this),this._firesTouchEvents(t))return;if(!this._acceptMouseLeave)return;const s=this._makeCompatEvent(t);this._processMouseEvent(s,this._handler.mouseLeaveEvent),this._acceptMouseLeave=!ct()}_longTapHandler(t){const e=mt(t.touches,this._activeTouchId);if(null===e)return;const i=this._makeCompatEvent(t,e);this._processTouchEvent(i,this._handler.longTapEvent),this._cancelTap=!0,this._longTapActive=!0}_firesTouchEvents(t){var e;return void 0!==(null===(e=t.sourceCapabilities)||void 0===e?void 0:e.firesTouchEvents)?t.sourceCapabilities.firesTouchEvents:vt(t)<this._lastTouchEventTimeStamp+500}_processTouchEvent(t,e){null==e||e.call(this._handler,t)}_processMouseEvent(t,e){null==e||e.call(this._handler,t)}_makeCompatEvent(t,e){var i;const n=null!=e?e:t,s=null!==(i=this._target.getBoundingClientRect())&&void 0!==i?i:{left:0,top:0};return{clientX:n.clientX,clientY:n.clientY,pageX:n.pageX,pageY:n.pageY,screenX:n.screenX,screenY:n.screenY,x:n.clientX-s.left,y:n.clientY-s.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,isTouch:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,srcType:t.type,target:n.target,view:t.view,preventDefault:()=>{"touchstart"!==t.type&&dt(t)}}}}function ut(t,e){const i=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.sqrt(i*i+n*n)}function dt(t){t.cancelable&&t.preventDefault()}function gt(t){return{x:t.pageX,y:t.pageY}}function vt(t){var e;return null!==(e=t.timeStamp)&&void 0!==e?e:performance.now()}function mt(t,e){for(let i=0;i<t.length;++i)if(t[i].identifier===e)return t[i];return null}class pt{constructor(){this._events=new Map}registerEvent(t,e){return this._events.set(t,e),this}onEvent(t,e){const i=this._events.get(t);return!(void 0===i||!this.checkEventOn(e))&&i(e)}checkEventOn(t){return!1}}class _t extends pt{constructor(){super(...arguments),this._elements=[]}checkEventOn(t){for(const e of this._elements)if(e.checkEventOn(t))return!0;return!1}dispatchEvent(t,e){for(let i=this._elements.length-1;i>=0;i--)if(this._elements[i].onEvent(t,e))return!0;return this.onEvent(t,e)}addElement(t){return this._elements.push(t),this}clear(){this._elements=[]}}class ft extends _t{constructor(t,e){super(),this._bounding=Q(),this._pane=e,this._init(t)}_init(t){if(this._container=n("div",this.getContainerStyle()),this.insertBefore()){const e=t.lastChild;null!==e?t.insertBefore(this._container,e):t.appendChild(this._container)}else t.appendChild(this._container);this.initDom(this._container),this._event=new ht(this.getEventContainer(),this,this.getEventOptions())}setBounding(t){return l(this._bounding,t),this}getContainer(){return this._container}getEventContainer(){return this._container}getEventOptions(){return{treatVertTouchDragAsPageScroll:()=>!1,treatHorzTouchDragAsPageScroll:()=>!1}}getBounding(){return this._bounding}getPane(){return this._pane}update(t){this.updateImp(t,this._container,this._bounding)}insertBefore(){return!1}}function xt(t){return null==window.requestAnimationFrame?window.setTimeout(t,20):window.requestAnimationFrame(t)}function yt(t){null==window.cancelAnimationFrame&&window.clearTimeout(t),window.cancelAnimationFrame(t)}const St=-1;class Ct extends ft{constructor(){super(...arguments),this._views=[],this._mainRequestAnimationId=St,this._overlayRequestAnimationId=St}getContainerStyle(){return{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box"}}initDom(t){this._mainCanvas=n("canvas",{position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"}),this._mainCtx=this._mainCanvas.getContext("2d"),this._overlayCanvas=n("canvas",{position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"}),this._overlayCtx=this._overlayCanvas.getContext("2d"),t.appendChild(this._mainCanvas),t.appendChild(this._overlayCanvas)}_optimalUpdateMain(){this._mainRequestAnimationId!==St&&(yt(this._mainRequestAnimationId),this._mainRequestAnimationId=St),this._mainRequestAnimationId=xt((()=>{this.updateMain(this._mainCtx)}))}_optimalUpdateOverlay(){this._overlayRequestAnimationId!==St&&(yt(this._overlayRequestAnimationId),this._overlayRequestAnimationId=St),this._overlayRequestAnimationId=xt((()=>{this.updateOverlay(this._overlayCtx)}))}addView(t){return this._views.push(t),this}updateImp(t,e,i){const{width:n,height:s,left:a}=i;e.style.left=`${a}px`;let r=t;if(n!==e.offsetWidth||s!==e.offsetHeight){this._mainCtx.clearRect(0,0,this._mainCanvas.offsetWidth,this._mainCanvas.offsetHeight),this._overlayCtx.clearRect(0,0,this._overlayCanvas.offsetWidth,this._overlayCanvas.offsetHeight);const t=`${n}px`,i=`${s}px`;e.style.width=t,e.style.height=i;const a=o(this._mainCanvas),l=Math.floor(n*a),c=Math.floor(s*a);this._mainCanvas.style.width=t,this._mainCanvas.style.height=i,this._mainCanvas.width=l,this._mainCanvas.height=c,this._mainCtx.scale(a,a),this._overlayCanvas.style.width=t,this._overlayCanvas.style.height=i,this._overlayCanvas.width=l,this._overlayCanvas.height=c,this._overlayCtx.scale(a,a),r=3}else 4!==r&&3!==r&&0!==r||this._mainCtx.clearRect(0,0,this._mainCanvas.offsetWidth,this._mainCanvas.offsetHeight),4!==r&&3!==r&&1!==r||this._overlayCtx.clearRect(0,0,this._overlayCanvas.offsetWidth,this._overlayCanvas.offsetHeight);switch(r){case 0:this._optimalUpdateMain();break;case 1:this._optimalUpdateOverlay();break;case 3:case 4:this._optimalUpdateMain(),this._optimalUpdateOverlay()}}getImage(t){const{width:e,height:i}=this.getBounding(),s=n("canvas",{width:`${e}px`,height:`${i}px`,boxSizing:"border-box"}),a=s.getContext("2d"),r=o(s);return s.width=e*r,s.height=i*r,a.scale(r,r),a.drawImage(this._mainCanvas,0,0,e,i),t&&a.drawImage(this._overlayCanvas,0,0,e,i),s}}class bt extends pt{constructor(t){super(),this.attrs=t.attrs,this.styles=t.styles}checkEventOn(t){return this.checkEventOnImp(t,this.attrs,this.styles)}draw(t){this.drawImp(t,this.attrs,this.styles)}static extend(t){return class extends bt{checkEventOnImp(e,i,n){return t.checkEventOn(e,i,n)}drawImp(e,i,n){t.draw(e,i,n)}}}}function wt(t,e){const i=t.x-e.x,n=t.y-e.y,s=e.r;return!(i*i+n*n>s*s)}function Et(t,e,i){const{x:n,y:s,r:o}=e,{style:a="fill",color:r="currentColor",borderSize:l=1,borderColor:c="currentColor",borderStyle:h="solid",borderDashedValue:u=[2,2]}=i;"fill"!==a&&"stroke_fill"!==i.style||(t.fillStyle=r,t.beginPath(),t.arc(n,s,o,0,2*Math.PI),t.closePath(),t.fill()),"stroke"!==a&&"stroke_fill"!==i.style||(t.strokeStyle=c,t.lineWidth=l,"dashed"===h?t.setLineDash(u):t.setLineDash([]),t.beginPath(),t.arc(n,s,o,0,2*Math.PI),t.closePath(),t.stroke())}const It={name:"circle",checkEventOn:wt,draw:(t,e,i)=>{Et(t,e,i)}};function Tt(t,e){let i=!1;const n=e.coordinates;for(let e=0,s=n.length-1;e<n.length;s=e++)n[e].y>t.y!=n[s].y>t.y&&t.x<(n[s].x-n[e].x)*(t.y-n[e].y)/(n[s].y-n[e].y)+n[e].x&&(i=!i);return i}function Pt(t,e,i){const{coordinates:n}=e,{style:s="fill",color:o="currentColor",borderSize:a=1,borderColor:r="currentColor",borderStyle:l="solid",borderDashedValue:c=[2,2]}=i;if("fill"===s||"stroke_fill"===i.style){t.fillStyle=o,t.beginPath(),t.moveTo(n[0].x,n[0].y);for(let e=1;e<n.length;e++)t.lineTo(n[e].x,n[e].y);t.closePath(),t.fill()}if("stroke"===s||"stroke_fill"===i.style){t.strokeStyle=r,t.lineWidth=a,"dashed"===l?t.setLineDash(c):t.setLineDash([]),t.beginPath(),t.moveTo(n[0].x,n[0].y);for(let e=1;e<n.length;e++)t.lineTo(n[e].x,n[e].y);t.closePath(),t.stroke()}}const Mt={name:"polygon",checkEventOn:Tt,draw:(t,e,i)=>{Pt(t,e,i)}};function Dt(t,e){return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height}function kt(t,e,i){const{x:n,y:s,width:o,height:a}=e,{style:r="fill",color:l="currentColor",borderSize:c=1,borderColor:h="currentColor",borderStyle:u="solid",borderRadius:d=0,borderDashedValue:g=[2,2]}=i;"fill"!==r&&"stroke_fill"!==i.style||(t.fillStyle=l,t.beginPath(),t.moveTo(n+d,s),t.arcTo(n+o,s,n+o,s+a,d),t.arcTo(n+o,s+a,n,s+a,d),t.arcTo(n,s+a,n,s,d),t.arcTo(n,s,n+o,s,d),t.closePath(),t.fill()),"stroke"!==r&&"stroke_fill"!==i.style||(t.strokeStyle=h,t.lineWidth=c,"dashed"===u?t.setLineDash(g):t.setLineDash([]),t.beginPath(),t.moveTo(n+d,s),t.arcTo(n+o,s,n+o,s+a,d),t.arcTo(n+o,s+a,n,s+a,d),t.arcTo(n,s+a,n,s,d),t.arcTo(n,s,n+o,s,d),t.closePath(),t.stroke())}const At={name:"rect",checkEventOn:Dt,draw:(t,e,i)=>{kt(t,e,i)}};function Ft(t,e,i){const{size:n=12,paddingLeft:s=0,paddingTop:o=0,paddingRight:a=0,paddingBottom:r=0}=e,{x:l,y:c,text:h,align:u="left",baseline:d="top"}=t,g=h.length;i=null!=i?i:n*g;const v=n;let m,p;switch(u){case"left":case"start":m=l;break;case"right":case"end":m=l-a-i-s;break;default:m=l-i/2-s}switch(d){case"top":case"hanging":p=c;break;case"bottom":case"ideographic":case"alphabetic":p=c-v-o-r;break;default:p=c-v/2-o}return{x:m,y:p,width:s+i+a,height:o+v+r}}function Lt(t,e,i){const{x:n,y:s,width:o,height:a}=Ft(e,i);return t.x>=n&&t.x<=n+o&&t.y>=s&&t.y<=s+a}function Rt(t,e,i){const{x:n,y:s,text:o,align:r="left",baseline:l="top"}=e,{color:c="currentColor",size:h=12,family:u,weight:d}=i;t.textAlign=r,t.textBaseline=l,t.font=a(h,d,u),t.fillStyle=c,t.fillText(o,n,s)}const Bt={name:"text",checkEventOn:(t,e,i)=>Lt(t,e,i),draw:(t,e,i)=>{Rt(t,e,i)}};function Vt(t,e,i){const{text:n}=e,{size:s=12,family:o,weight:r,paddingLeft:l=0,paddingTop:c=0}=i;t.font=a(s,r,o);const h=Ft(e,i,t.measureText(n).width);kt(t,h,{...i,color:i.backgroundColor}),Rt(t,{x:h.x+l,y:h.y+c,text:n,align:"left",baseline:"top"},i)}const Ot={name:"rectText",checkEventOn:(t,e,i)=>Lt(t,e,i),draw:(t,e,i)=>{Vt(t,e,i)}},Nt={};[It,j,Mt,At,Bt,Ot].forEach((t=>{Nt[t.name]=bt.extend(t)}));class zt extends _t{constructor(t){super(),this._widget=t}getWidget(){return this._widget}createFigure(t,e,i,n){const s=function(t){var e;return null!==(e=Nt[t])&&void 0!==e?e:null}(t);if(null!==s){const o=new s({name:t,attrs:e,styles:i});if(void 0!==n){for(const t in n)n.hasOwnProperty(t)&&o.registerEvent(t,n[t]);this.addElement(o)}return o}return null}draw(t){this.clear(),this.drawImp(t)}}class Wt extends zt{drawImp(t){var e;const i=this.getWidget(),n=this.getWidget().getPane(),s=n.getChart(),o=i.getBounding(),a=s.getStyles().grid;if(a.show){t.save(),t.globalCompositeOperation="destination-over";const i=a.horizontal;if(i.show){(null===(e=s.getPaneById(tt.XAXIS))||void 0===e?void 0:e.getAxisComponent()).getTicks().forEach((e=>{var n;null===(n=this.createFigure("line",{coordinates:[{x:e.coord,y:0},{x:e.coord,y:o.height}]},i))||void 0===n||n.draw(t)}))}const r=a.vertical;if(r.show){n.getAxisComponent().getTicks().forEach((e=>{var i;null===(i=this.createFigure("line",{coordinates:[{x:0,y:e.coord},{x:o.width,y:e.coord}]},r))||void 0===i||i.draw(t)}))}t.restore()}}}class Yt extends zt{eachChildren(t){const e=this.getWidget().getPane().getChart().getChartStore(),i=e.getVisibleDataList(),n=e.getTimeScaleStore().getBarSpace();i.forEach(((e,i)=>{t(e,n,i)}))}}class Ht extends Yt{drawImp(t){const e=this.getWidget().getPane(),i=e.getChart().getChartStore(),n=this.getCandleBarOptions(i);if(null!==n){const i=e.getAxisComponent();this.eachChildren(((e,s)=>{this._drawCandleBar(t,i,e,s,n)}))}}getCandleBarOptions(t){const e=t.getStyles().candle;return{type:e.type,styles:e.bar}}_drawCandleBar(t,e,i,n,s){const{data:o,x:a}=i,{open:r,high:l,low:c,close:h}=o,{halfGapBar:u,gapBar:d}=n,{type:g,styles:v}=s;let m;m=h>r?v.upColor:h<r?v.downColor:v.noChangeColor;const p=e.convertToPixel(r),_=e.convertToPixel(h),f=[p,_,e.convertToPixel(l),e.convertToPixel(c)];f.sort(((t,e)=>t-e));const x=Math.max(1,f[2]-f[1]);let y=[];"ohlc"!==g?(y.push({name:"rect",attrs:{x:a-.5,y:f[0],width:1,height:f[1]-f[0]},styles:{color:m}}),"candle_stroke"===g||"candle_up_stroke"===g&&r<h||"candle_down_stroke"===g&&r>h?y.push({name:"rect",attrs:{x:a-u+.5,y:f[1],width:d-1,height:x},styles:{style:"stroke",borderColor:m}}):y.push({name:"rect",attrs:{x:a-u,y:f[1],width:d,height:x},styles:{color:m}}),y.push({name:"rect",attrs:{x:a-.5,y:f[2],width:1,height:f[3]-f[2]},styles:{color:m}})):y=[{name:"rect",attrs:{x:a-.5,y:f[0],width:1,height:f[3]-f[0]},styles:{color:m}},{name:"rect",attrs:{x:a-u,y:p,width:u,height:1},styles:{color:m}},{name:"rect",attrs:{x:a,y:_,width:u,height:1},styles:{color:m}}],y.forEach((({attrs:e,styles:i})=>{var n;null===(n=this.createFigure("rect",e,i))||void 0===n||n.draw(t)}))}}class Xt extends Ht{getCandleBarOptions(t){const e=this.getWidget().getPane();if(!e.getAxisComponent().isInCandle()){const i=t.getIndicatorStore().getInstances(e.getId());for(const e of i){const i=e[1];if(i.shouldOhlc){const e=i.styles,n=t.getStyles().indicator;return{type:"ohlc",styles:{upColor:f(e,"ohlc.upColor",n.ohlc.upColor),downColor:f(e,"ohlc.downColor",n.ohlc.downColor),noChangeColor:f(e,"ohlc.noChangeColor",n.ohlc.noChangeColor)}}}}}return null}drawImp(t){var e;super.drawImp(t);const i=this.getWidget(),n=i.getPane(),s=n.getChart(),o=i.getBounding(),a=null===(e=s.getPaneById(tt.XAXIS))||void 0===e?void 0:e.getAxisComponent(),r=n.getAxisComponent(),l=s.getChartStore(),c=l.getDataList(),h=l.getTimeScaleStore(),u=h.getVisibleRange(),d=l.getIndicatorStore().getInstances(n.getId()),g=l.getStyles().indicator;d.forEach((e=>{var i;let n=!1;if(null!==e.draw&&(t.save(),n=null!==(i=e.draw({ctx:t,kLineDataList:c,indicator:e,visibleRange:u,bounding:o,barSpace:h.getBarSpace(),defaultStyles:g,xAxis:a,yAxis:r}))&&void 0!==i&&i,t.restore()),!n){const i=e.result,n=[],s=[],o=[];this.eachChildren(((a,l)=>{var h;const{halfGapBar:d,gapBar:m}=l,{dataIndex:p,x:_}=a,f=null!==(h=i[p])&&void 0!==h?h:{};D(c,e,p,g,((e,i,a,l)=>{var c,h,g;const x=f[e.key],y=r.convertToPixel(x);switch(e.type){case"circle":v(x)&&(null===(c=this.createFigure("circle",{x:_,y:y,r:d},{style:i.style,color:i.color,borderColor:i.color}))||void 0===c||c.draw(t));break;case"bar":if(v(x)){const n=null!==(h=e.baseValue)&&void 0!==h?h:r.getExtremum().min,s=r.convertToPixel(n),o=Math.abs(s-y);let a;a=y>s?s:o<1?s-1:y,null===(g=this.createFigure("rect",{x:_-d,y:a,width:m,height:o},{style:i.style,color:i.color,borderColor:i.color}))||void 0===g||g.draw(t)}break;case"line":{let t=null;if(v(x)){t=i;const e={x:_,y:y},r=n[l];v(s[l])||(s[l]=[]),s[l].push(e),v(r)&&((null==r?void 0:r.color)!==i.color||(null==r?void 0:r.style)!==i.style)&&(o.push({name:"line",attrs:{coordinates:s[l]},styles:{style:i.style,color:i.color,size:a.size,dashedValue:a.dashedValue}}),s[l]=[e]),p===u.to-1&&o.push({name:"line",attrs:{coordinates:s[l]},styles:{style:i.style,color:null==i?void 0:i.color,size:a.size,dashedValue:a.dashedValue}})}n[l]=t;break}}}))})),o.forEach((({attrs:e,styles:i})=>{var n;null===(n=this.createFigure("line",e,i))||void 0===n||n.draw(t)}))}}))}}class $t extends zt{drawImp(t){const e=this.getWidget(),i=e.getPane(),n=e.getBounding(),s=e.getPane().getChart().getChartStore(),o=s.getCrosshairStore().get(),a=s.getStyles().crosshair;if(void 0!==o.paneId&&a.show){if(o.paneId===i.getId()){const e=o.y;this._drawLine(t,[{x:0,y:e},{x:n.width,y:e}],a.horizontal)}const e=o.realX;this._drawLine(t,[{x:e,y:0},{x:e,y:n.height}],a.horizontal)}}_drawLine(t,e,i){var n;if(i.show){const s=i.line;s.show&&(null===(n=this.createFigure("line",{coordinates:e},s))||void 0===n||n.draw(t))}}}class jt extends zt{drawImp(t){const e=this.getWidget(),i=e.getPane(),n=i.getChart().getChartStore(),s=n.getCrosshairStore().get();if(void 0!==s.kLineData){const o=e.getBounding(),a=n.getCustomApi(),r=n.getIndicatorStore().getInstances(i.getId()),l=n.getStyles().indicator;this.drawIndicatorTooltip(t,n.getDataList(),s,r,a,o,l)}}drawIndicatorTooltip(t,e,i,n,s,o,r,l){const c=r.tooltip;let h=0;if(this.isDrawTooltip(i,c)){const u=c.text,d=u.marginLeft,g=u.marginRight,v=u.size,m=u.weight,p=u.family;let _=null!=l?l:0;t.font=a(v,m,p),n.forEach((n=>{var a;const{name:l,calcParamsText:f,values:x}=this.getIndicatorTooltipData(e,i,n,s,r),y=void 0!==l&&l.length>0,S=void 0!==x&&x.length>0;let C=0;if(y||S){if(_+=u.marginTop,h+=u.marginTop+v+u.marginBottom,y&&c.showName){C+=d;let e=l;void 0!==f&&f.length>0&&c.showParams&&(e=`${e}${f}`),null===(a=this.createFigure("text",{x:C,y:_,text:e},{color:u.color,size:v,family:p,weight:m}))||void 0===a||a.draw(t),C+=t.measureText(e).width+g}if(S){const e=this.drawStandardTooltip(t,o,x,C,_,u);h+=e,_+=e}_+=v+u.marginBottom}}))}return h}drawStandardTooltip(t,e,i,n,s,o){let r=n,l=s,c=0;const{marginLeft:h,marginTop:u,marginRight:d,marginBottom:g,size:v,family:m,weight:p}=o;return t.font=a(v,p,m),i.forEach(((i,n)=>{var s,o;const a=i.title,_=i.value,f=t.measureText(a.text).width,x=t.measureText(_.text).width;r+h+(f+x)+d>e.width?(r=h,c+=v+u+g,l+=v+u+g):r+=h,null===(s=this.createFigure("text",{x:r,y:l,text:a.text},{color:a.color,size:v,family:m,weight:p}))||void 0===s||s.draw(t),r+=f,null===(o=this.createFigure("text",{x:r,y:l,text:_.text},{color:_.color,size:v,family:m,weight:p}))||void 0===o||o.draw(t),r+=x+d})),c}isDrawTooltip(t,e){const i=e.showRule;return"always"===i||"follow_cross"===i&&void 0!==t.paneId}getIndicatorTooltipData(t,e,i,n,s){var o,a,r;if(null!==i.createToolTipDataSource){const n=this.getWidget(),a=n.getPane(),r=a.getChart().getChartStore(),l=i.createToolTipDataSource({kLineDataList:t,indicator:i,visibleRange:r.getTimeScaleStore().getVisibleRange(),bounding:n.getBounding(),crosshair:e,defaultStyles:s,xAxis:null===(o=a.getChart().getPaneById(tt.XAXIS))||void 0===o?void 0:o.getAxisComponent(),yAxis:a.getAxisComponent()});if(void 0!==l.values){const t=[],e=s.tooltip.text.color;l.values.forEach((i=>{let n={text:"",color:e};d(i.title)?n=i.title:n.text=i.title;let s={text:"",color:e};d(i.value)?s=i.value:s.text=i.value,t.push({title:n,value:s})})),l.values=t}return l}const l=e.dataIndex,c=null!==(a=i.result)&&void 0!==a?a:[];let h="";const u=i.calcParams;u.length>0&&(h=`(${u.join(",")})`);const g=null!==(r=c[l])&&void 0!==r?r:{},m=[];return D(t,i,l,s,((t,e)=>{if(void 0!==t.title){const o=e.color;let a=g[t.key];v(a)&&(a=y(a,i.precision),i.shouldFormatBigNumber&&(a=n.formatBigNumber(a))),m.push({title:{text:t.title,color:o},value:{text:null!=a?a:s.tooltip.defaultValue,color:o}})}})),{name:i.shortName,calcParamsText:h,values:m}}}class Gt extends zt{constructor(t){super(t),this._initEvent()}_initEvent(){const t=this.getWidget().getPane(),e=t.getId(),i=t.getChart().getChartStore().getOverlayStore();this.registerEvent("mouseMoveEvent",(t=>{var n;const s=i.getProgressInstanceInfo();if(null!==s){const o=s.instance;return o.isStart()&&i.updateProgressInstanceInfo(e),o.isDrawing()&&(o.eventMoveForDrawing(this._coordinateToPoint(s.instance,t)),null===(n=o.onDrawing)||void 0===n||n.call(o,{overlay:o,...t})),this._figureMouseMoveEvent(s.instance,"point",s.instance.points.length-1,0)(t)}return i.setHoverInstanceInfo({paneId:e,instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1},t),!1})).registerEvent("touchMouseDownEvent",(t=>{var n,s;const o=i.getProgressInstanceInfo();if(null!==o){const a=o.instance;return a.isStart()&&i.updateProgressInstanceInfo(e,!0),a.isDrawing()&&(a.eventMoveForDrawing(this._coordinateToPoint(a,t)),null===(n=a.onDrawing)||void 0===n||n.call(a,{overlay:a,...t}),a.nextStep(),a.isDrawing()||(i.progressInstanceComplete(),null===(s=a.onDrawEnd)||void 0===s||s.call(a,{overlay:a,...t}))),this._figureTouchMouseDownEvent(a,"point",a.points.length-1,0)(t)}return i.setClickInstanceInfo({paneId:e,instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1},t),!1})).registerEvent("mouseRightClickEvent",(t=>{const e=i.getProgressInstanceInfo();if(null!==e){const i=e.instance;if(i.isDrawing())return this._figureMouseRightClickEvent(i,"point",i.points.length-1,0)(t)}return!1})).registerEvent("touchMouseUpEvent",(t=>{var n;const{instance:s}=i.getPressedInstanceInfo();return null!==s&&(null===(n=s.onPressedMoveEnd)||void 0===n||n.call(s,{overlay:s,...t})),i.setPressedInstanceInfo({paneId:e,instance:null,figureType:"none",figureIndex:-1,attrsIndex:-1}),!1})).registerEvent("pressedTouchMouseMoveEvent",(t=>{var e,n;const{instance:s,figureType:o,figureIndex:a}=i.getPressedInstanceInfo();if(null!==s){if(!(s.lock||null!==(n=null===(e=s.onPressedMoving)||void 0===e?void 0:e.call(s,{overlay:s,...t}))&&void 0!==n&&n)){const e=this._coordinateToPoint(s,t);"point"===o?s.eventPressedPointMove(e,a):s.eventPressedOtherMove(e,this.getWidget().getPane().getChart().getChartStore().getTimeScaleStore())}return!0}return!1}))}_figureEvents(t,e,i,n){if(!t.isDrawing())return{mouseMoveEvent:this._figureMouseMoveEvent(t,e,i,n),touchMouseDownEvent:this._figureTouchMouseDownEvent(t,e,i,n),mouseRightClickEvent:this._figureMouseRightClickEvent(t,e,i,n)}}_figureMouseMoveEvent(t,e,i,n){return s=>{const o=this.getWidget().getPane();return o.getChart().getChartStore().getOverlayStore().setHoverInstanceInfo({paneId:o.getId(),instance:t,figureType:e,figureIndex:i,attrsIndex:n},s),!0}}_figureTouchMouseDownEvent(t,e,i,n){return s=>{var o;const a=this.getWidget().getPane(),r=a.getId(),l=a.getChart().getChartStore().getOverlayStore();return t.startPressedMove(this._coordinateToPoint(t,s)),null===(o=t.onPressedMoveStart)||void 0===o||o.call(t,{overlay:t,...s}),l.setPressedInstanceInfo({paneId:r,instance:t,figureType:e,figureIndex:i,attrsIndex:n}),l.setClickInstanceInfo({paneId:r,instance:t,figureType:e,figureIndex:i,attrsIndex:n},s),!0}}_figureMouseRightClickEvent(t,e,i,n){return e=>{var i,n;if(null===(n=null===(i=t.onRightClick)||void 0===i?void 0:i.call(t,{overlay:t,...e}))||void 0===n||!n){this.getWidget().getPane().getChart().getChartStore().getOverlayStore().removeInstance(t)}return!0}}_coordinateToPoint(t,e){var i,n;const s={},o=this.getWidget().getPane(),a=o.getChart(),r=o.getId(),l=a.getChartStore().getTimeScaleStore();if(this.coordinateToPointTimestampDataIndexFlag()){const t=(null===(i=a.getPaneById(tt.XAXIS))||void 0===i?void 0:i.getAxisComponent()).convertFromPixel(e.x),o=null!==(n=l.dataIndexToTimestamp(t))&&void 0!==n?n:void 0;s.dataIndex=t,s.timestamp=o}if(this.coordinateToPointValueFlag()){const i=o.getAxisComponent();let n=i.convertFromPixel(e.y);if("normal"!==t.mode&&r===tt.CANDLE&&void 0!==s.dataIndex){const e=l.getDataByDataIndex(s.dataIndex);if(null!==e)if(n>e.high)if("weak_magnet"===t.mode){const t=i.convertToPixel(e.high);n<i.convertFromPixel(t-8)&&(n=e.high)}else n=e.high;else if(n<e.low)if("weak_magnet"===t.mode){const t=i.convertToPixel(e.low);n>i.convertFromPixel(t-8)&&(n=e.low)}else n=e.low;else{const t=Math.max(e.open,e.close),i=Math.min(e.open,e.close);n=n>t?n-t<e.high-n?t:e.high:n<i?n-e.low<i-n?e.low:i:t-n<n-i?t:i}}s.value=n}return s}coordinateToPointValueFlag(){return!0}coordinateToPointTimestampDataIndexFlag(){return!0}dispatchEvent(t,e){return this.getWidget().getPane().getChart().getChartStore().getOverlayStore().isDrawing()?this.onEvent(t,e):super.dispatchEvent(t,e)}checkEventOn(t){return!0}drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),s=n.getId(),o=n.getChart(),a=n.getAxisComponent(),r=null===(e=o.getPaneById(tt.XAXIS))||void 0===e?void 0:e.getAxisComponent(),l=i.getBounding(),c=o.getChartStore(),h=c.getCustomApi(),u=c.getTimeScaleStore(),d=u.getDateTimeFormat(),g=u.getBarSpace(),v=c.getPrecision(),m=c.getStyles().overlay,p=c.getOverlayStore(),_=p.getHoverInstanceInfo(),f=p.getClickInstanceInfo();this.getCompleteOverlays(p,s).forEach((e=>{this._drawOverlay(t,e,l,g,v,d,h,m,r,a,_,f,u)}));const x=p.getProgressInstanceInfo();if(null!==x){const e=this.getProgressOverlay(x,s);null!==e&&this._drawOverlay(t,e,l,g,v,d,h,m,r,a,_,f,u)}}_drawOverlay(t,e,i,n,s,o,a,r,l,c,h,u,d){const{points:g}=e,v=g.map((t=>{var e,i;let n=t.dataIndex;return void 0!==t.timestamp&&(n=d.timestampToDataIndex(t.timestamp)),{x:null!==(e=null==l?void 0:l.convertToPixel(n))&&void 0!==e?e:0,y:null!==(i=null==c?void 0:c.convertToPixel(t.value))&&void 0!==i?i:0}}));if(v.length>0){const a=(new Array).concat(this.getFigures(e,v,i,n,s,o,r,l,c));this.drawFigures(t,e,a,r)}this.drawDefaultFigures(t,e,v,i,s,o,a,r,l,c,h,u)}drawFigures(t,e,i,n){i.forEach(((i,s)=>{const{type:o,styles:a,attrs:r,ignoreEvent:l}=i;[].concat(r).forEach(((i,r)=>{var c,h;const u=void 0!==l&&l?void 0:this._figureEvents(e,"other",s,r),d={...n[o],...null===(c=e.styles)||void 0===c?void 0:c[o],...a};null===(h=this.createFigure(o,i,d,u))||void 0===h||h.draw(t)}))}))}getCompleteOverlays(t,e){return t.getInstances(e)}getProgressOverlay(t,e){return t.paneId===e?t.instance:null}getFigures(t,e,i,n,s,o,a,r,l){var c,h;return null!==(h=null===(c=t.createPointFigures)||void 0===c?void 0:c.call(t,{overlay:t,coordinates:e,bounding:i,barSpace:n,precision:s,dateTimeFormat:o,defaultStyles:a,xAxis:r,yAxis:l}))&&void 0!==h?h:[]}drawDefaultFigures(t,e,i,n,s,o,a,r,l,c,h,u){var d,g;if(e.needDefaultPointFigure&&((null===(d=h.instance)||void 0===d?void 0:d.id)===e.id&&"none"!==h.figureType||(null===(g=u.instance)||void 0===g?void 0:g.id)===e.id&&"none"!==u.figureType)){const n=e.styles,s={...r.point,...null==n?void 0:n.point};i.forEach((({x:i,y:n},o)=>{var a,r,l;let c=s.radius,u=s.color,d=s.borderColor,g=s.borderSize;(null===(a=h.instance)||void 0===a?void 0:a.id)===e.id&&"point"===h.figureType&&h.figureIndex===o&&(c=s.activeRadius,u=s.activeColor,d=s.activeBorderColor,g=s.activeBorderSize),null===(r=this.createFigure("circle",{x:i,y:n,r:c+g},{color:d},this._figureEvents(e,"point",o,0)))||void 0===r||r.draw(t),null===(l=this.createFigure("circle",{x:i,y:n,r:c},{color:u}))||void 0===l||l.draw(t)}))}}}class Ut extends Ct{constructor(t,e){super(t,e),this._gridView=new Wt(this),this._indicatorView=new Xt(this),this._crosshairLineView=new $t(this),this._tooltipView=this.createTooltipView(),this._overlayView=new Gt(this),this._flingStartTime=(new Date).getTime(),this._flingScrollTimerId=null,this._startScrollCoordinate=null,this._touchCoordinate=null,this._touchCancelCrosshair=!1,this._touchZoomed=!1,this._pinchScale=1,this._prevExtremum=null,this.getEventContainer().style.cursor="crosshair"}pinchStartEvent(){this._pinchScale=1,this._touchZoomed=!0}pinchEvent(t,e){const i=5*(e-this._pinchScale);this._pinchScale=e,this.getPane().getChart().getChartStore().getTimeScaleStore().zoom(i,t)}mouseWheelHorizontalEvent(t){const e=this.getPane().getChart().getChartStore().getTimeScaleStore();e.startScroll(),e.scroll(t)}mouseWheelVerticalEvent(t,e){this.getPane().getChart().getChartStore().getTimeScaleStore().zoom(e,t)}pressedMouseMoveEvent(t){const e=this.getPane(),i=e.getId(),n=e.getChart().getChartStore(),s=n.getCrosshairStore();if(!this.dispatchEvent("pressedTouchMouseMoveEvent",t)&&null!==this._startScrollCoordinate){const e=this.getPane().getAxisComponent();if(null!==this._prevExtremum&&!e.getAutoCalcTickFlag()){const{min:i,max:n,range:s}=this._prevExtremum;let o;o=e.isReverse()?this._startScrollCoordinate.y-t.y:t.y-this._startScrollCoordinate.y;const a=s*(o/this.getBounding().height),r=i+a,l=n+a,c=e.convertToRealValue(r),h=e.convertToRealValue(l);e.setExtremum({min:r,max:l,range:l-r,realMin:c,realMax:h,realRange:h-c})}const i=t.x-this._startScrollCoordinate.x;n.getTimeScaleStore().scroll(i)}const{height:o,width:a}=this.getBounding();t.x>0&&t.x<a&&t.y>0&&t.y<o&&s.set({x:t.x,y:t.y,paneId:i})}mouseUpEvent(t){if(this.dispatchEvent("touchMouseUpEvent",t)){this.getPane().getChart().updatePane(1)}this._startScrollCoordinate=null,this._prevExtremum=null}mouseDownEvent(t){this.dispatchEvent("touchMouseDownEvent",t),this._prevExtremum={...this.getPane().getAxisComponent().getExtremum()},this._startScrollCoordinate={x:t.x,y:t.y},this.getPane().getChart().getChartStore().getTimeScaleStore().startScroll()}mouseRightClickEvent(t){this.dispatchEvent("mouseRightClickEvent",t)&&this.getPane().getChart().updatePane(1)}mouseMoveEvent(t){this.dispatchEvent("mouseMoveEvent",t);const e=this.getPane(),i=e.getChart().getChartStore();i.getDragPaneFlag()||i.getCrosshairStore().set({x:t.x,y:t.y,paneId:e.getId()})}mouseLeaveEvent(t){this.getPane().getChart().getChartStore().getCrosshairStore().set()}touchStartEvent(t){const e=this.getPane(),i=e.getId(),n=e.getChart(),s=n.getChartStore(),o=s.getCrosshairStore();if(this.dispatchEvent("touchMouseDownEvent",t))return this._touchCancelCrosshair=!0,this._touchCoordinate=null,o.set(void 0,!0),void n.updatePane(1);if(null!==this._flingScrollTimerId&&(clearTimeout(this._flingScrollTimerId),this._flingScrollTimerId=null),this._flingStartTime=(new Date).getTime(),this._startScrollCoordinate={x:t.x,y:t.y},s.getTimeScaleStore().startScroll(),this._touchZoomed=!1,null!==this._touchCoordinate){const e=t.x-this._touchCoordinate.x,n=t.y-this._touchCoordinate.y;Math.sqrt(e*e+n*n)<10?(this._touchCoordinate={x:t.x,y:t.y},o.set({x:t.x,y:t.y,paneId:i})):(this._touchCancelCrosshair=!0,this._touchCoordinate=null,o.set())}else this._touchCancelCrosshair=!1}tapEvent(t){if(null===this._touchCoordinate&&!this._touchCancelCrosshair&&!this._touchZoomed){this._touchCoordinate={x:t.x,y:t.y};const e=this.getPane();e.getChart().getChartStore().getCrosshairStore().set({x:t.x,y:t.y,paneId:e.getId()})}}_touchEventPaneCrosshair(t,e){const i=t.getBounding();if(e.y>=0&&e.y<=i.height)return{y:e.y,paneId:t.getId()};if(e.y<0){const i=t.getTopPane();if(null!==i){const t=i.getBounding();return this._touchEventPaneCrosshair(i,{x:e.x,y:t.height+e.y})}}if(e.y>i.height){const n=t.getBottomPane();if(null!==n)return this._touchEventPaneCrosshair(n,{x:e.x,y:e.y-i.height})}return null}touchMoveEvent(t){const e=this.getPane(),i=e.getChart();if(this.dispatchEvent("pressedTouchMouseMoveEvent",t))return t.preventDefault(),void i.updatePane(1);const n=i.getChartStore();let s;if(null!==this._touchCoordinate){t.preventDefault();const{width:i}=this.getBounding();if(t.x>0&&t.x<i){const i=this._touchEventPaneCrosshair(e,t);null!==i&&(this._touchCoordinate={x:t.x,y:t.y},s={x:t.x,...i})}n.getCrosshairStore().set(s)}else if(null!==this._startScrollCoordinate&&Math.abs(this._startScrollCoordinate.x-t.x)>this._startScrollCoordinate.y-t.y){const e=t.x-this._startScrollCoordinate.x;n.getTimeScaleStore().scroll(e)}}touchEndEvent(t){if(this.dispatchEvent("touchMouseUpEvent",t),null!==this._startScrollCoordinate){const e=(new Date).getTime()-this._flingStartTime;let i=(t.x-this._startScrollCoordinate.x)/(e>0?e:1)*20;if(e<200&&Math.abs(i)>0){const t=this.getPane().getChart().getChartStore().getTimeScaleStore(),e=()=>{this._flingScrollTimerId=setTimeout((()=>{t.startScroll(),t.scroll(i),i*=.975,Math.abs(i)<1?null!==this._flingScrollTimerId&&(clearTimeout(this._flingScrollTimerId),this._flingScrollTimerId=null):e()}),20)};e()}}}longTapEvent(t){this._touchCoordinate={x:t.x,y:t.y};const e=this.getPane();this.getPane().getChart().getChartStore().getCrosshairStore().set({x:t.x,y:t.y,paneId:e.getId()})}dispatchEvent(t,e){return this._overlayView.dispatchEvent(t,e)}updateMain(t){this.updateMainContent(t),this._indicatorView.draw(t),this._gridView.draw(t)}createTooltipView(){return new jt(this)}updateMainContent(t){}updateOverlay(t){this._overlayView.draw(t),this._crosshairLineView.draw(t),this._tooltipView.draw(t)}}class Zt extends Yt{drawImp(t){var e,i;const n=this.getWidget(),s=n.getPane(),o=s.getChart(),a=s.getChart().getChartStore(),r=n.getBounding(),l=s.getAxisComponent(),c=a.getTimeScaleStore().getBarSpace(),u=o.getStyles().candle.area,d=[],v=[];let m=Number.MAX_SAFE_INTEGER;this.eachChildren(((t,e,i)=>{const{data:n,x:s}=t,{halfGapBar:o}=e,a=n[u.value];if(g(a)){const t=l.convertToPixel(a);if(0===i){const e=s-o;v.push({x:e,y:r.height}),v.push({x:e,y:t}),d.push({x:e,y:t})}d.push({x:s,y:t}),v.push({x:s,y:t}),m=Math.min(m,t)}}));const p=v.length;if(p>0){const t=v[p-1],e=t.x+c.halfGapBar;d.push({x:e,y:t.y}),v.push({x:e,y:t.y}),v.push({x:e,y:r.height})}if(d.length>0&&(null===(e=this.createFigure("line",{coordinates:d},{color:u.lineColor,size:u.lineSize}))||void 0===e||e.draw(t)),v.length>0){const e=u.backgroundColor;let n;if(h(e)){const i=t.createLinearGradient(0,r.height,0,m);try{e.forEach((({offset:t,color:e})=>{i.addColorStop(t,e)}))}catch(t){}n=i}else n=e;null===(i=this.createFigure("polygon",{coordinates:v},{color:n}))||void 0===i||i.draw(t)}}}class qt extends Yt{drawImp(t){const e=this.getWidget().getPane(),i=e.getChart().getChartStore(),n=i.getStyles().candle.priceMark,s=n.high,o=n.low;if(n.show&&(s.show||o.show)){const n=i.getPrecision(),a=e.getAxisComponent();let r=Number.MIN_SAFE_INTEGER,l=0,c=Number.MAX_SAFE_INTEGER,h=0;this.eachChildren(((t,e,i)=>{const{data:n,x:s}=t;r<n.high&&(r=n.high,l=s),c>n.low&&(c=n.low,h=s)}));const u=a.convertToPixel(r),d=a.convertToPixel(c);s.show&&r!==Number.MIN_SAFE_INTEGER&&this._drawMark(t,y(r,n.price),{x:l,y:u},u<d?[-2,-5]:[2,5],s),o.show&&c!==Number.MAX_SAFE_INTEGER&&this._drawMark(t,y(c,n.price),{x:h,y:d},u<d?[2,5]:[-2,-5],o)}}_drawMark(t,e,i,n,s){var o,a,r;const l=i.x,c=i.y+n[0];let h,u,d;null===(o=this.createFigure("line",{coordinates:[{x:l-2,y:c+n[0]},{x:l,y:c},{x:l+2,y:c+n[0]}]},{color:s.color}))||void 0===o||o.draw(t);const{width:g}=this.getWidget().getBounding();l>g/2?(h=l-5,u=h-s.textOffset,d="right"):(h=l+5,d="left",u=h+s.textOffset);const v=c+n[1];null===(a=this.createFigure("line",{coordinates:[{x:l,y:c},{x:l,y:v},{x:h,y:v}]},{color:s.color}))||void 0===a||a.draw(t),null===(r=this.createFigure("text",{x:u,y:v,text:e,align:d,baseline:"middle"},{color:s.color,size:s.textSize,family:s.textFamily,weight:s.textWeight}))||void 0===r||r.draw(t)}}class Kt extends zt{drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),s=i.getBounding(),o=n.getChart().getChartStore(),a=o.getStyles().candle.priceMark,r=a.last,l=r.line;if(a.show&&r.show&&l.show){const i=n.getAxisComponent(),a=o.getDataList(),c=a[a.length-1];if(null!=c){const{close:n,open:o}=c,a=i.convertToNicePixel(n);let h;h=n>o?r.upColor:n<o?r.downColor:r.noChangeColor,null===(e=this.createFigure("line",{coordinates:[{x:0,y:a},{x:s.width,y:a}]},{style:l.style,color:h,size:l.size,dashedValue:l.dashedValue}))||void 0===e||e.draw(t)}}}}const Jt={"zh-CN":{time:"时间：",open:"开：",high:"高：",low:"低：",close:"收：",volume:"成交量："},"en-US":{time:"Time: ",open:"Open: ",high:"High: ",low:"Low: ",close:"Close: ",volume:"Volume: "}};function Qt(t,e){var i,n;return null!==(n=null===(i=Jt[e])||void 0===i?void 0:i[t])&&void 0!==n?n:t}class te extends jt{drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),s=n.getChart().getChartStore(),o=s.getCrosshairStore().get();if(void 0!==o.kLineData){const a=i.getBounding(),r=null===(e=n.getYAxisWidget())||void 0===e?void 0:e.getBounding(),l=s.getDataList(),c=s.getPrecision(),h=s.getLocale(),u=s.getCustomApi(),d=s.getIndicatorStore().getInstances(n.getId()),g=s.getTimeScaleStore().getDateTimeFormat(),v=s.getStyles(),m=v.candle,p=v.indicator;if("rect"===m.tooltip.showType&&"rect"===p.tooltip.showType){const e=this.isDrawTooltip(o,m.tooltip),i=this.isDrawTooltip(o,p.tooltip);this._drawRectTooltip(t,l,d,a,r,o,c,g,h,u,e,i,v,0)}else if("standard"===m.tooltip.showType&&"standard"===p.tooltip.showType){const e=this._drawCandleStandardTooltip(t,a,o,c,g,h,u,m);this.drawIndicatorTooltip(t,l,o,d,u,a,p,e)}else if("rect"===m.tooltip.showType&&"standard"===p.tooltip.showType){const e=this.drawIndicatorTooltip(t,l,o,d,u,a,p,0),i=this.isDrawTooltip(o,m.tooltip);this._drawRectTooltip(t,l,d,a,r,o,c,g,h,u,i,!1,v,e)}else{const e=this._drawCandleStandardTooltip(t,a,o,c,g,h,u,m),i=this.isDrawTooltip(o,p.tooltip);this._drawRectTooltip(t,l,d,a,r,o,c,g,h,u,!1,i,v,e)}}}_drawCandleStandardTooltip(t,e,i,n,s,o,a,r){const l=r.tooltip,c=l.text;let h=0;if(this.isDrawTooltip(i,l)){const l=this._getCandleTooltipData(i.kLineData,n,s,o,a,r);l.length>0&&(h+=c.marginTop+c.size+c.marginBottom,h+=this.drawStandardTooltip(t,e,l,0,c.marginTop,c))}return h}_drawRectTooltip(t,e,i,n,s,o,r,l,c,h,u,d,g,v){var m,p;const _=g.candle,f=g.indicator,x=_.tooltip,y=f.tooltip;if(u||d){const S=this._getCandleTooltipData(o.kLineData,r,l,c,h,_),{marginLeft:C,marginRight:b,marginTop:w,marginBottom:E,size:I,weight:T,family:P}=x.text,{paddingLeft:M,paddingRight:D,paddingTop:k,paddingBottom:A,offsetLeft:F,offsetRight:L,offsetTop:R,borderSize:B,borderRadius:V,borderColor:O,color:N}=x.rect;let z=0,W=0,Y=0;u&&(t.font=a(I,T,P),S.forEach((e=>{const i=e.title,n=e.value,s=`${i.text}${n.text}`,o=t.measureText(s).width+C+b;z=Math.max(z,o)})),Y+=(E+w+I)*S.length);const{marginLeft:H,marginRight:X,marginTop:$,marginBottom:j,size:G,weight:U,family:Z}=y.text,q=[];if(d&&(t.font=a(G,U,Z),i.forEach((i=>{var n;const s=null!==(n=this.getIndicatorTooltipData(e,o,i,h,f).values)&&void 0!==n?n:[];q.push(s),s.forEach((e=>{const i=e.title,n=e.value,s=`${i.text}${n.text}`,o=t.measureText(s).width+H+X;z=Math.max(z,o),Y+=$+j+G}))}))),W+=z,0!==W&&0!==Y){W+=2*B+M+D,Y+=2*B+k+A;const e=n.width/2;let i;(null!==(m=o.realX)&&void 0!==m?m:0)<e?(i=n.width-L-W,g.yAxis.inside&&"right"===g.yAxis.position&&(i-=s.width)):(i=F,g.yAxis.inside&&"left"===g.yAxis.position&&(i+=s.width));const a=v+R;null===(p=this.createFigure("rect",{x:i,y:a,width:W,height:Y},{style:"stroke_fill",color:N,borderColor:O,borderSize:B,borderRadius:V}))||void 0===p||p.draw(t);const r=i+B+M+C;let l=a+B+k;if(u&&S.forEach((e=>{var n,s;l+=w;const o=e.title;null===(n=this.createFigure("text",{x:r,y:l,text:o.text},{color:o.color,size:I,family:P,weight:T}))||void 0===n||n.draw(t);const a=e.value;null===(s=this.createFigure("text",{x:i+W-B-b-D,y:l,text:a.text,align:"right"},{color:a.color,size:I,family:P,weight:T}))||void 0===s||s.draw(t),l+=I+E})),d){const e=i+B+M+H;q.forEach((n=>{n.forEach((n=>{var s,o;l+=$;const a=n.title,r=n.value;null===(s=this.createFigure("text",{x:e,y:l,text:a.text},{color:a.color,size:G,family:Z,weight:U}))||void 0===s||s.draw(t),null===(o=this.createFigure("text",{x:i+W-B-X-D,y:l,text:r.text,align:"right"},{color:r.color,size:G,family:Z,weight:U}))||void 0===o||o.draw(t),l+=G+j}))}))}}}}_getCandleTooltipData(t,e,i,n,s,o){var a,r,l;const c=o.tooltip,h=c.text.color;let g=[];if(u(c.custom)){(null!==(r=null===(a=c.custom)||void 0===a?void 0:a.call(c,t,o))&&void 0!==r?r:[]).forEach((({title:t,value:e})=>{let i={text:"",color:""};d(t)?i=t:(i.text=t,i.color=h),i.text=Qt(i.text,n);let s={text:"",color:""};d(e)?s=e:(s.text=e,s.color=h),g.push({title:i,value:s})}))}else{const{price:o,volume:a}=e;g=[{title:{text:Qt("time",n),color:h},value:{text:s.formatDate(i,t.timestamp,"YYYY-MM-DD HH:mm",0),color:h}},{title:{text:Qt("open",n),color:h},value:{text:y(t.open,o),color:h}},{title:{text:Qt("high",n),color:h},value:{text:y(t.high,o),color:h}},{title:{text:Qt("low",n),color:h},value:{text:y(t.low,o),color:h}},{title:{text:Qt("close",n),color:h},value:{text:y(t.close,o),color:h}},{title:{text:Qt("volume",n),color:h},value:{text:s.formatBigNumber(y(null!==(l=t.volume)&&void 0!==l?l:c.defaultValue,a)),color:h}}]}return g}}class ee extends Ut{constructor(){super(...arguments),this._candleBarView=new Ht(this),this._candleAreaView=new Zt(this),this._candleHighLowPriceView=new qt(this),this._candleLastPriceLineView=new Kt(this)}updateMainContent(t){"area"!==this.getPane().getChart().getStyles().candle.type?(this._candleBarView.draw(t),this._candleHighLowPriceView.draw(t),this._candleLastPriceLineView.draw(t)):this._candleAreaView.draw(t)}createTooltipView(){return new te(this)}}function ie(t,e){let i=0;return function(){const n=Date.now();n-i>(null!=e?e:20)&&(t.apply(this,arguments),i=n)}}class ne extends ft{constructor(){super(...arguments),this._dragFlag=!1,this._dragStartY=0,this._topPaneHeight=0,this._currentPaneHeight=0,this.touchMoveEvent=ie(this._pressedTouchMouseMoveEvent,20),this.pressedMouseMoveEvent=ie(this._pressedTouchMouseMoveEvent,20)}getEventContainer(){return this._moveDom}getEventOptions(){return{treatVertTouchDragAsPageScroll:()=>!1,treatHorzTouchDragAsPageScroll:()=>!0}}touchStartEvent(t){this.mouseDownEvent(t)}touchEndEvent(){this.mouseUpEvent()}mouseDownEvent(t){var e,i;this._dragFlag=!0,this._dragStartY=t.pageY;const n=this.getPane();this._topPaneHeight=null!==(i=null===(e=n.getTopPane())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,this._currentPaneHeight=n.getBounding().height}mouseUpEvent(){this.mouseLeaveEvent(),this._dragFlag=!1}_pressedTouchMouseMoveEvent(t){const e=t.pageY-this._dragStartY,i=this.getPane(),n=i.getTopPane(),s=e<0;if(null!==n&&i.getOptions().dragEnabled){let t,o,a,r;s?(t=n,o=i,a=this._topPaneHeight,r=this._currentPaneHeight):(t=i,o=n,a=this._currentPaneHeight,r=this._topPaneHeight);const l=t.getOptions().minHeight;if(a>l){const n=Math.max(a-Math.abs(e),l),s=a-n;t.setBounding({height:n}),o.setBounding({height:r+s});const c=i.getChart();c.getChartStore().getActionStore().execute("onPaneDrag",{paneId:i.getId}),c.adjustPaneViewport(!1,!0,!0,!0,!0)}}}mouseEnterEvent(){const t=this.getPane();if(t.getOptions().dragEnabled){const e=t.getChart(),i=e.getStyles().separator;this._moveDom.style.background=i.activeBackgroundColor;const n=e.getChartStore();n.setDragPaneFlag(!0),n.getCrosshairStore().set()}}mouseLeaveEvent(){this._dragFlag||(this._moveDom.style.background="",this.getPane().getChart().getChartStore().setDragPaneFlag(!1))}getContainerStyle(){return{margin:"0",padding:"0",position:"relative",boxSizing:"border-box"}}insertBefore(){return!0}initDom(t){this._moveDom=n("div",{width:"100%",height:"7px",margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box",cursor:"ns-resize"}),t.appendChild(this._moveDom)}updateImp(t,e,i){if(4===t||2===t){const t=this.getPane().getChart().getStyles().separator;this._moveDom.style.top=-Math.floor((7-t.size)/2)+"px";const n=t.fill;e.style.backgroundColor=t.color,e.style.height=`${t.size}px`,e.style.marginLeft=`${n?0:i.left}px`,e.style.width=n?"100%":`${i.width}px`}}getImage(){const t=this.getPane().getChart().getStyles().separator,e=this.getContainer().offsetWidth,i=t.size,s=n("canvas",{width:`${e}px`,height:`${i}px`,boxSizing:"border-box"}),a=s.getContext("2d"),r=o(s);return s.width=e*r,s.height=i*r,a.scale(r,r),a.fillStyle=t.color,a.fillRect(this.getBounding().left,0,e,i),s}}class se extends zt{drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),s=i.getBounding(),o=n.getAxisComponent(),a=this.getAxisStyles(n.getChart().getStyles());if(a.show){a.axisLine.show&&(null===(e=this.createFigure("line",this.createAxisLine(s,a),a.axisLine))||void 0===e||e.draw(t));const i=o.getTicks();if(a.tickLine.show){this.createTickLines(i,s,a).forEach((e=>{var i;null===(i=this.createFigure("line",e,a.tickLine))||void 0===i||i.draw(t)}))}if(a.tickText.show){this.createTickTexts(i,s,a).forEach((e=>{var i;null===(i=this.createFigure("text",e,a.tickText))||void 0===i||i.draw(t)}))}}}}class oe extends se{getAxisStyles(t){return t.yAxis}createAxisLine(t,e){const i=this.getWidget().getPane().getAxisComponent(),n=e.axisLine.size;let s;return s=i.isFromZero()?n/2:t.width-n,{coordinates:[{x:s,y:0},{x:s,y:t.height}]}}createTickLines(t,e,i){const n=this.getWidget().getPane().getAxisComponent(),s=i.axisLine,o=i.tickLine;let a=0,r=0;return n.isFromZero()?(a=0,s.show&&(a+=s.size),r=a+o.length):(a=e.width,s.show&&(a-=s.size),r=a-o.length),t.map((t=>({coordinates:[{x:a,y:t.coord},{x:r,y:t.coord}]})))}createTickTexts(t,e,i){const n=this.getWidget().getPane().getAxisComponent(),s=i.axisLine,o=i.tickLine,a=i.tickText;let r=0;n.isFromZero()?(r=a.marginStart,s.show&&(r+=s.size),o.show&&(r+=o.length)):(r=e.width-a.marginEnd,s.show&&(r-=s.size),o.show&&(r-=o.length));const l=this.getWidget().getPane().getAxisComponent().isFromZero()?"left":"right";return t.map((t=>({x:r,y:t.coord,text:t.text,align:l,baseline:"middle"})))}}class ae extends zt{drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),s=i.getBounding(),o=n.getChart().getChartStore(),a=o.getStyles().candle.priceMark,r=a.last,l=r.text;if(a.show&&r.show&&l.show){const i=o.getPrecision(),a=n.getAxisComponent(),c=o.getDataList(),h=o.getVisibleDataList(),u=c[c.length-1];if(void 0!==u){const{close:n,open:o}=u,c=a.convertToNicePixel(n);let d,g,v,m;if(d=n>o?r.upColor:n<o?r.downColor:r.noChangeColor,"percentage"===a.getType()){const t=h[0].data.close;g=`${((n-t)/t*100).toFixed(2)}%`}else g=y(n,i.price);a.isFromZero()?(v=0,m="left"):(v=s.width,m="right"),null===(e=this.createFigure("rectText",{x:v,y:c,text:g,align:m,baseline:"middle"},{...l,backgroundColor:d}))||void 0===e||e.draw(t)}}}}class re extends zt{drawImp(t){const e=this.getWidget(),i=e.getPane(),n=e.getBounding(),s=i.getChart().getChartStore(),o=s.getCustomApi(),a=s.getStyles().indicator,r=a.lastValueMark,l=r.text;if(r.show){const e=i.getAxisComponent(),r=s.getDataList(),c=r.length-1;s.getIndicatorStore().getInstances(i.getId()).forEach((i=>{const s=i.result[c];if(void 0!==s){const h=i.precision;D(r,i,c,a,((a,r)=>{var c;const u=s[a.key];if(v(u)){const s=e.convertToNicePixel(u);let a,d,g=y(u,h);i.shouldFormatBigNumber&&(g=o.formatBigNumber(g)),e.isFromZero()?(a=0,d="left"):(a=n.width,d="right"),null===(c=this.createFigure("rectText",{x:a,y:s,text:g,align:d,baseline:"middle"},{...l,backgroundColor:r.color}))||void 0===c||c.draw(t)}}))}}))}}}class le extends Gt{coordinateToPointTimestampDataIndexFlag(){return!1}drawDefaultFigures(t,e,i,n,s,o,a,r,l,c,h,u){this.drawFigures(t,e,this.getDefaultFigures(e,i,n,s,o,a,l,c,u),r)}getDefaultFigures(t,e,i,n,s,o,a,r,l){var c,h;const u=[];if(t.needDefaultYAxisFigure&&t.id===(null===(c=l.instance)||void 0===c?void 0:c.id)&&l.paneId===this.getWidget().getPane().getId()){let s=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;let a,l;null!==(h=null==r?void 0:r.isFromZero())&&void 0!==h&&h?(a="left",l=0):(a="right",l=i.width),e.forEach(((e,i)=>{s=Math.min(s,e.y),o=Math.max(o,e.y);const r=y(t.points[i].value,n.price);u.push({type:"rectText",attrs:{x:l,y:e.y,text:r,align:a,baseline:"middle"},ignoreEvent:!0})})),e.length>1&&u.unshift({type:"rect",attrs:{x:0,y:s,width:i.width,height:o-s},ignoreEvent:!0})}return u}getFigures(t,e,i,n,s,o,a,r,l){var c,h;return null!==(h=null===(c=t.createYAxisFigures)||void 0===c?void 0:c.call(t,{overlay:t,coordinates:e,bounding:i,barSpace:n,precision:s,dateTimeFormat:o,defaultStyles:a,xAxis:r,yAxis:l}))&&void 0!==h?h:[]}}class ce extends zt{drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),s=i.getBounding(),o=i.getPane().getChart().getChartStore(),r=o.getCrosshairStore().get(),l=o.getStyles().crosshair;if(void 0!==r.paneId&&void 0!==r.kLineData&&this.checkPaneId(r,n.getId())&&l.show){const i=this.getDirectionStyles(l),c=i.text;if(i.show&&c.show){const i=n.getAxisComponent(),l=this.getText(r,o,i);t.font=a(c.size,c.weight,c.family),null===(e=this.createFigure("rectText",this.getTextAttrs(l,t.measureText(l).width,r,s,i,c),c))||void 0===e||e.draw(t)}}}checkPaneId(t,e){return t.paneId===e}getDirectionStyles(t){return t.horizontal}getText(t,e,i){var n,s;const o=i,a=i.convertFromPixel(t.y);let r;if("percentage"===o.getType()){const t=null!==(s=null===(n=e.getVisibleDataList()[0])||void 0===n?void 0:n.data)&&void 0!==s?s:{};r=`${((a-t.close)/t.close*100).toFixed(2)}%`}else{const i=e.getIndicatorStore().getInstances(t.paneId);let n=0,s=!1;o.isInCandle()?n=e.getPrecision().price:i.forEach((t=>{n=Math.max(t.precision,n),s||(s=t.shouldFormatBigNumber)})),r=y(a,n),s&&(r=e.getCustomApi().formatBigNumber(r))}return r}getTextAttrs(t,e,i,n,s,o){let a,r;return s.isFromZero()?(a=0,r="left"):(a=n.width,r="right"),{x:a,y:i.y,text:t,align:r,baseline:"middle"}}}class he extends Ct{constructor(t,e){super(t,e),this._yAxisView=new oe(this),this._candleLastPriceLabelView=new ae(this),this._indicatorLastValueView=new re(this),this._overlayYAxisView=new le(this),this._crosshairHorizontalLabelView=new ce(this),this._prevExtremum=null,this._startScaleDistance=0,this.getEventContainer().style.cursor="ns-resize"}getEventOptions(){return{treatVertTouchDragAsPageScroll:()=>!1,treatHorzTouchDragAsPageScroll:()=>!0}}mouseUpEvent(t){if(this.dispatchEvent("touchMouseUpEvent",t)){this.getPane().getChart().updatePane(1)}this._prevExtremum=null,this._startScaleDistance=0}mouseRightClickEvent(t){this.dispatchEvent("mouseRightClickEvent",t)&&this.getPane().getChart().updatePane(1)}mouseDownEvent(t){this.dispatchEvent("touchMouseDownEvent",t)&&this.getPane().getChart().updatePane(1),this._prevExtremum={...this.getPane().getAxisComponent().getExtremum()},this._startScaleDistance=t.y}mouseMoveEvent(t){this.dispatchEvent("mouseMoveEvent",t)&&this.getPane().getChart().updatePane(1)}pressedMouseMoveEvent(t){const e=this.getPane(),i=e.getChart();if(this.dispatchEvent("pressedTouchMouseMoveEvent",t))i.updatePane(1);else{const n=this.getBounding();if(null!==this._prevExtremum&&t.x>0&&t.x<n.width&&t.y>0&&t.y<n.height){const{min:n,max:s,range:o}=this._prevExtremum,a=o*(t.y/this._startScaleDistance),r=(a-o)/2,l=n-r,c=s+r,h=e.getAxisComponent(),u=h.convertToRealValue(l),d=h.convertToRealValue(c);h.setExtremum({min:l,max:c,range:a,realMin:u,realMax:d,realRange:d-u}),i.adjustPaneViewport(!1,!0,!0,!0)}}}mouseDoubleClickEvent(t){const e=this.getPane(),i=e.getAxisComponent();i.getAutoCalcTickFlag()||(i.setAutoCalcTickFlag(!0),e.getChart().adjustPaneViewport(!1,!0,!0,!0))}touchStartEvent(t){this.dispatchEvent("touchMouseDownEvent",t)&&this.getPane().getChart().updatePane(1)}touchMoveEvent(t){this.dispatchEvent("pressedTouchMouseMoveEvent",t)&&(t.preventDefault(),this.getPane().getChart().updatePane(1))}touchEndEvent(t){this.dispatchEvent("touchMouseUpEvent",t)&&this.getPane().getChart().updatePane(1)}dispatchEvent(t,e){return this._overlayYAxisView.dispatchEvent(t,e)}updateMain(t){this._yAxisView.draw(t),this.getPane().getAxisComponent().isInCandle()&&this._candleLastPriceLabelView.draw(t),this._indicatorLastValueView.draw(t)}updateOverlay(t){this._overlayYAxisView.draw(t),this._crosshairHorizontalLabelView.draw(t)}}class ue{constructor(t){this._extremum={min:0,max:0,range:0,realMin:0,realMax:0,realRange:0},this._prevExtremum={min:0,max:0,range:0,realMin:0,realMax:0,realRange:0},this._ticks=[],this._autoCalcTickFlag=!0,this._parent=t}getParent(){return this._parent}buildTicks(t){return this._autoCalcTickFlag&&(this._extremum=this.calcExtremum()),!(this._prevExtremum.min===this._extremum.min&&this._prevExtremum.max===this._extremum.max&&!t)&&(this._prevExtremum=this._extremum,this._ticks=this.optimalTicks(this._calcTicks()),!0)}getTicks(){return this._ticks}setExtremum(t){this._autoCalcTickFlag=!1,this._extremum=t}getExtremum(){return this._extremum}setAutoCalcTickFlag(t){this._autoCalcTickFlag=t}getAutoCalcTickFlag(){return this._autoCalcTickFlag}_calcTicks(){const{realMin:t,realMax:e,realRange:i}=this._extremum,n=[];if(i>=0){const[s,o]=this._calcTickInterval(i),a=b(Math.ceil(t/s)*s,o),r=b(Math.floor(e/s)*s,o);let l=0,c=a;if(0!==s)for(;c<=r;){const t=c.toFixed(o);n[l]={text:t,coord:0,value:t},++l,c+=s}}return n}_calcTickInterval(t){const e=function(t){const e=Math.floor(E(t)),i=I(e),n=t/i;let s=0;return s=n<1.5?1:n<2.5?2:n<3.5?3:n<4.5?4:n<5.5?5:n<6.5?6:8,t=s*i,e>=-20?+t.toFixed(e<0?-e:0):t}(t/8);return[e,function(t){const e=t.toString(),i=e.indexOf("e");if(i>0){const t=+e.slice(i+1);return t<0?-t:0}{const t=e.indexOf(".");return t<0?0:e.length-1-t}}(e)]}}class de extends ue{calcExtremum(){var t,e,i,n,s;const o=this.getParent(),a=o.getChart(),r=a.getChartStore();let l=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER;const h=[];let u=!1,d=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER,m=Number.MAX_SAFE_INTEGER;r.getIndicatorStore().getInstances(o.getId()).forEach((t=>{var e,i,n;u||(u=null!==(e=t.shouldOhlc)&&void 0!==e&&e),m=Math.min(m,t.precision),null!==t.minValue&&(d=Math.min(d,t.minValue)),null!==t.maxValue&&(g=Math.max(g,t.maxValue)),h.push({figures:null!==(i=t.figures)&&void 0!==i?i:[],result:null!==(n=t.result)&&void 0!==n?n:[]})}));let p=4;const _=this.isInCandle();if(_){const{price:t}=r.getPrecision();p=m!==Number.MAX_SAFE_INTEGER?Math.min(m,t):t}else m!==Number.MAX_SAFE_INTEGER&&(p=m);const f=r.getVisibleDataList(),x=a.getStyles().candle,y="area"===x.type,S=x.area.value,C=_&&!y||!_&&u;f.forEach((({dataIndex:t,data:e})=>{C&&(l=Math.min(l,e.low),c=Math.max(c,e.high)),_&&y&&(l=Math.min(l,e[S]),c=Math.max(c,e[S])),h.forEach((({figures:e,result:i})=>{var n;const s=null!==(n=i[t])&&void 0!==n?n:{};e.forEach((t=>{const e=s[t.key];v(e)&&(l=Math.min(l,e),c=Math.max(c,e))}))}))})),l!==Number.MAX_SAFE_INTEGER&&c!==Number.MIN_SAFE_INTEGER?(l=Math.min(d,l),c=Math.max(g,c)):(l=0,c=10);const b=this.getType();let w;switch(b){case"percentage":{const e=null===(t=f[0])||void 0===t?void 0:t.data;void 0!==(null==e?void 0:e.close)&&(l=(l-e.close)/e.close*100,c=(c-e.close)/e.close*100),w=Math.pow(10,-2);break}case"log":l=E(l),c=E(c),w=.05*I(-p);break;default:w=I(-p)}if(l===c||Math.abs(l-c)<w){const t=d===l,e=g===c;l=t?l:e?l-8*w:l-4*w,c=e?c:t?c+8*w:c+4*w}const T=null!==(i=null===(e=this.getParent().getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,{gap:P}=o.getOptions();let M=null!==(n=null==P?void 0:P.top)&&void 0!==n?n:.2;M>=1&&(M/=T);let D=null!==(s=null==P?void 0:P.bottom)&&void 0!==s?s:.1;D>=1&&(D/=T);let k,A,F,L=Math.abs(c-l);return l-=L*D,c+=L*M,L=Math.abs(c-l),"log"===b?(k=I(l),A=I(c),F=Math.abs(A-k)):(k=l,A=c,F=L),{min:l,max:c,range:L,realMin:k,realMax:A,realRange:F}}_innerConvertToPixel(t){var e,i;const n=null!==(i=null===(e=this.getParent().getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,{min:s,range:o}=this.getExtremum(),a=(t-s)/o;return this.isReverse()?Math.round(a*n):Math.round((1-a)*n)}isInCandle(){return"candle"===this.getParent().getName()}getType(){return this.isInCandle()?this.getParent().getChart().getStyles().yAxis.type:"normal"}getPosition(){return this.getParent().getChart().getStyles().yAxis.position}isReverse(){return!!this.isInCandle()&&this.getParent().getChart().getStyles().yAxis.reverse}isFromZero(){const t=this.getParent().getChart().getStyles().yAxis,e=t.inside;return"left"===t.position&&e||"right"===t.position&&!e}optimalTicks(t){var e,i;const n=this.getParent(),s=null!==(i=null===(e=n.getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,o=n.getChart().getChartStore(),a=o.getCustomApi(),r=[],l=this.getType(),c=o.getIndicatorStore().getInstances(n.getId());let h=0,u=!1;this.isInCandle()?h=o.getPrecision().price:c.forEach((t=>{h=Math.max(h,t.precision),u||(u=t.shouldFormatBigNumber)}));const d=o.getStyles().xAxis.tickText.size;let g;return t.forEach((({value:t})=>{let e,i=this._innerConvertToPixel(+t);switch(l){case"percentage":e=`${y(t,2)}%`;break;case"log":i=this._innerConvertToPixel(E(+t)),e=y(t,h);break;default:e=y(t,h),u&&(e=a.formatBigNumber(t))}i>d&&i<s-d&&(void 0!==g&&Math.abs(g-i)>2*d||void 0===g)&&(r.push({text:e,coord:i,value:t}),g=i)})),r}getAutoSize(){const t=this.getParent(),e=t.getChart(),i=e.getChartStore(),n=i.getCustomApi(),s=e.getStyles(),o=s.yAxis,a=o.size;if("auto"!==a)return a;let l=0;if(o.show&&(o.axisLine.show&&(l+=o.axisLine.size),o.tickLine.show&&(l+=o.tickLine.length),o.tickText.show)){let t=0;this.getTicks().forEach((e=>{t=Math.max(t,r(e.text,o.tickText.size,o.tickText.weight,o.tickText.family))})),l+=o.tickText.marginStart+o.tickText.marginEnd+t}const c=s.crosshair;let h=0;if(c.show&&c.horizontal.show&&c.horizontal.text.show){const e=i.getIndicatorStore().getInstances(t.getId());let o=0,a=!1;e.forEach((t=>{o=Math.max(t.precision,o),a||(a=t.shouldFormatBigNumber)}));let l=2;if("percentage"!==this.getType())if(this.isInCandle()){const{price:t}=i.getPrecision(),e=s.indicator.lastValueMark;l=e.show&&e.text.show?Math.max(o,t):t}else l=o;let u=y(this.getExtremum().max,l);a&&(u=n.formatBigNumber(u)),h+=c.horizontal.text.paddingLeft+c.horizontal.text.paddingRight+2*c.horizontal.text.borderSize+r(u,c.horizontal.text.size,c.horizontal.text.weight,c.horizontal.text.family)}return Math.max(l,h)}convertFromPixel(t){var e,i,n;const s=null!==(i=null===(e=this.getParent().getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,{min:o,range:a}=this.getExtremum(),r=(this.isReverse()?t/s:1-t/s)*a+o;switch(this.getType()){case"percentage":{const t=null===(n=this.getParent().getChart().getChartStore().getVisibleDataList()[0])||void 0===n?void 0:n.data;return void 0!==(null==t?void 0:t.close)?t.close*r/100+t.close:0}case"log":return I(r);default:return r}}convertToRealValue(t){var e;let i=t;switch(this.getType()){case"percentage":{const n=null===(e=this.getParent().getChart().getChartStore().getVisibleDataList()[0])||void 0===e?void 0:e.data;void 0!==(null==n?void 0:n.close)&&(i=(t-n.close)/n.close*100);break}case"log":i=E(t);break;default:i=t}return i}convertToPixel(t){return this._innerConvertToPixel(this.convertToRealValue(t))}convertToNicePixel(t){var e,i;const n=null!==(i=null===(e=this.getParent().getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,s=this.convertToPixel(t);return Math.round(Math.max(.05*n,Math.min(s,.98*n)))}}class ge extends et{getName(){return"indicator"}createAxisComponent(){return new de(this)}createMainWidget(t){return new Ut(t,this)}createSeparatorWidget(t){return new ne(t,this)}creatYAxisWidget(t){return new he(t,this)}}class ve extends ge{getName(){return"candle"}createMainWidget(t){return new ee(t,this)}createSeparatorWidget(t){return null}}class me extends se{getAxisStyles(t){return t.xAxis}createAxisLine(t,e){const i=e.axisLine.size/2;return{coordinates:[{x:0,y:i},{x:t.width,y:i}]}}createTickLines(t,e,i){const n=i.tickLine,s=i.axisLine.size;return t.map((t=>({coordinates:[{x:t.coord,y:0},{x:t.coord,y:s+n.length}]})))}createTickTexts(t,e,i){const n=i.tickText,s=i.axisLine.size,o=i.tickLine.length;return t.map((t=>({x:t.coord,y:s+o+n.marginStart,text:t.text,align:"center",baseline:"top"})))}}class pe extends le{coordinateToPointTimestampDataIndexFlag(){return!0}coordinateToPointValueFlag(){return!1}getCompleteOverlays(t){return t.getInstances()}getProgressOverlay(t){return t.instance}getDefaultFigures(t,e,i,n,s,o,a,r,l){var c;const h=[];if(t.needDefaultXAxisFigure&&t.id===(null===(c=l.instance)||void 0===c?void 0:c.id)){let n=Number.MAX_SAFE_INTEGER,a=Number.MIN_SAFE_INTEGER;e.forEach(((e,i)=>{n=Math.min(n,e.x),a=Math.max(a,e.x);const r=t.points[i];if(void 0!==r.timestamp){const t=o.formatDate(s,r.timestamp,"YYYY-MM-DD HH:mm",1);h.push({type:"rectText",attrs:{x:e.x,y:0,text:t,align:"center"},ignoreEvent:!0})}})),e.length>1&&h.unshift({type:"rect",attrs:{x:n,y:0,width:a-n,height:i.height},ignoreEvent:!0})}return h}getFigures(t,e,i,n,s,o,a,r,l){var c,h;return null!==(h=null===(c=t.createXAxisFigures)||void 0===c?void 0:c.call(t,{overlay:t,coordinates:e,bounding:i,barSpace:n,precision:s,dateTimeFormat:o,defaultStyles:a,xAxis:r,yAxis:l}))&&void 0!==h?h:[]}}class _e extends ce{checkPaneId(t){return t.dataIndex===t.realDataIndex}getDirectionStyles(t){return t.vertical}getText(t,e,i){var n;const s=null===(n=t.kLineData)||void 0===n?void 0:n.timestamp;return e.getCustomApi().formatDate(e.getTimeScaleStore().getDateTimeFormat(),s,"YYYY-MM-DD HH:mm",1)}getTextAttrs(t,e,i,n,s,o){const a=i.realX;let r;return r=a-e/2-o.paddingLeft<0?o.paddingLeft+e/2:a+e/2+o.paddingRight>n.width?n.width-o.paddingRight-e/2:a,{x:r,y:0,text:t,align:"center",baseline:"top"}}}class fe extends Ct{constructor(t,e){super(t,e),this._xAxisView=new me(this),this._overlayXAxisView=new pe(this),this._crosshairVerticalLabelView=new _e(this),this._startScaleCoordinate=null,this._startScaleDistance=0,this._scale=1,this.getEventContainer().style.cursor="ew-resize"}mouseUpEvent(t){if(this.dispatchEvent("touchMoseUpEvent",t)){this.getPane().getChart().updatePane(1)}this._startScaleCoordinate=null,this._startScaleDistance=0,this._scale=1}mouseMoveEvent(t){this.dispatchEvent("mouseMoveEvent",t)&&this.getPane().getChart().updatePane(1)}mouseDownEvent(t){if(this.dispatchEvent("touchMouseDownEvent",t)){this.getPane().getChart().updatePane(1)}this._startScaleCoordinate={x:t.x,y:t.y},this._startScaleDistance=t.x}mouseRightClickEvent(t){this.dispatchEvent("mouseRightClickEvent",t)&&this.getPane().getChart().updatePane(1)}pressedMouseMoveEvent(t){var e;const i=this.getPane().getChart();if(this.dispatchEvent("pressedTouchMouseMoveEvent",t))i.updatePane(1);else{const n=this.getBounding();if(t.x>0&&t.x<n.width&&t.y>0&&t.y<n.height){const n=this._startScaleDistance/t.x,s=10*(n-this._scale);this._scale=n,i.getChartStore().getTimeScaleStore().zoom(s,null!==(e=this._startScaleCoordinate)&&void 0!==e?e:void 0)}}}touchStartEvent(t){this.dispatchEvent("touchMouseDownEvent",t)&&this.getPane().getChart().updatePane(1)}touchMoveEvent(t){this.dispatchEvent("pressedTouchMouseMoveEvent",t)&&(t.preventDefault(),this.getPane().getChart().updatePane(1))}touchEndEvent(t){this.dispatchEvent("touchMouseUpEvent",t)&&this.getPane().getChart().updatePane(1)}getEventOptions(){return{treatVertTouchDragAsPageScroll:()=>!0,treatHorzTouchDragAsPageScroll:()=>!1}}updateMain(t){this._xAxisView.draw(t)}updateOverlay(t){this._overlayXAxisView.draw(t),this._crosshairVerticalLabelView.draw(t)}}class xe extends ue{calcExtremum(){const t=this.getParent().getChart().getChartStore(),{from:e,to:i}=t.getTimeScaleStore().getVisibleRange(),n=i-1,s=i-e;return{min:e,max:n,range:s,realMin:e,realMax:n,realRange:s}}optimalTicks(t){var e,i;const n=this.getParent().getChart(),s=n.getChartStore(),o=s.getCustomApi().formatDate,a=[],l=t.length,c=s.getDataList();if(l>0){const h=s.getTimeScaleStore().getDateTimeFormat(),u=n.getStyles().xAxis.tickText,d=r("00-00 00:00",u.size,u.weight,u.family),g=parseInt(t[0].value,10),v=this.convertToPixel(g);let m=1;if(l>1){const e=parseInt(t[1].value,10),i=this.convertToPixel(e),n=Math.abs(i-v);n<d&&(m=Math.ceil(d/n))}for(let i=0;i<l;i+=m){const n=parseInt(t[i].value,10),s=c[n].timestamp;let r=o(h,s,"HH:mm",2);if(0!==i){const n=c[parseInt(t[i-m].value,10)].timestamp;r=null!==(e=this._optimalTickLabel(o,h,s,n))&&void 0!==e?e:r}const l=this.convertToPixel(n);a.push({text:r,coord:l,value:s})}if(1===a.length)a[0].text=o(h,a[0].value,"YYYY-MM-DD HH:mm",2);else{const t=a[0].value,e=a[1].value;if(void 0!==a[2]){const e=a[2].text;/^[0-9]{2}-[0-9]{2}$/.test(e)?a[0].text=o(h,t,"MM-DD",2):/^[0-9]{4}-[0-9]{2}$/.test(e)?a[0].text=o(h,t,"YYYY-MM",2):/^[0-9]{4}$/.test(e)&&(a[0].text=o(h,t,"YYYY",2))}else a[0].text=null!==(i=this._optimalTickLabel(o,h,t,e))&&void 0!==i?i:a[0].text}}return a}_optimalTickLabel(t,e,i,n){const s=t(e,i,"YYYY",2),o=t(e,i,"YYYY-MM",2),a=t(e,i,"MM-DD",2);return s!==t(e,n,"YYYY",2)?s:o!==t(e,n,"YYYY-MM",2)?o:a!==t(e,n,"MM-DD",2)?a:null}getAutoSize(){const t=this.getParent().getChart().getStyles(),e=t.xAxis,i=e.size;if("auto"!==i)return i;const n=t.crosshair;let s=0;e.show&&(e.axisLine.show&&(s+=e.axisLine.size),e.tickLine.show&&(s+=e.tickLine.length),e.tickText.show&&(s+=e.tickText.marginStart+e.tickText.marginEnd+e.tickText.size));let o=0;return n.show&&n.vertical.show&&n.vertical.text.show&&(o+=n.vertical.text.paddingTop+n.vertical.text.paddingBottom+2*n.vertical.text.borderSize+n.vertical.text.size),Math.max(s,o)}convertFromPixel(t){return this.getParent().getChart().getChartStore().getTimeScaleStore().coordinateToDataIndex(t)}convertToPixel(t){return this.getParent().getChart().getChartStore().getTimeScaleStore().dataIndexToCoordinate(t)}}class ye extends et{getName(){return"xAxis"}createAxisComponent(){return new xe(this)}createMainWidget(t){return new fe(t,this)}}class Se{constructor(t,e){this._panes=new Map,this._boundKeyBoardDownEvent=t=>{if(t.shiftKey)switch(t.code){case"Equal":this._chartStore.getTimeScaleStore().zoom(.5);break;case"Minus":this._chartStore.getTimeScaleStore().zoom(-.5);break;case"ArrowLeft":{const t=this._chartStore.getTimeScaleStore();t.startScroll(),t.scroll(-3*t.getBarSpace().bar);break}case"ArrowRight":{const t=this._chartStore.getTimeScaleStore();t.startScroll(),t.scroll(3*t.getBarSpace().bar);break}}},this._initContainer(t),this._chartStore=new rt(this,e),this._xAxisPane=new ye(this._chartContainer,this,tt.XAXIS),this._panes.set(tt.CANDLE,new ve(this._chartContainer,this,tt.CANDLE)),this.adjustPaneViewport(!0,!0,!0)}_initContainer(t){this._container=t,this._chartContainer=n("div",{position:"relative",width:"100%",outline:"none",borderStyle:"none",cursor:"crosshair",boxSizing:"border-box",userSelect:"none",webkitUserSelect:"none",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent"}),this._chartContainer.tabIndex=1,this._chartContainer.addEventListener("keydown",this._boundKeyBoardDownEvent),t.appendChild(this._chartContainer)}_measurePaneHeight(){var t;const e=this._container.offsetHeight,i=this._xAxisPane.getAxisComponent().getAutoSize();let n=e-i;n<0&&(n=0);let s=0;this._panes.forEach((t=>{if(t.getId()!==tt.CANDLE){let e=t.getBounding().height;const i=t.getOptions().minHeight;e<i&&(e=i),s+e>n?(s=n,e=Math.max(n-s,0)):s+=e,t.setBounding({height:e})}}));const o=n-s;null===(t=this._panes.get(tt.CANDLE))||void 0===t||t.setBounding({height:o});let a=0;this._panes.forEach((t=>{t.setBounding({top:a}),a+=t.getBounding().height})),this._xAxisPane.setBounding({height:i,top:a})}_measurePaneWidth(){const t=this._chartStore.getStyles().yAxis,e="left"===t.position,i=!t.inside,n=this._container.offsetWidth;let s=0,o=Number.MIN_SAFE_INTEGER,a=0,r=0;this._panes.forEach((t=>{o=Math.max(o,t.getAxisComponent().getAutoSize())})),o>n&&(o=n),i?(s=n-o,e?(a=0,r=o):(a=n-o,r=0)):(s=n,r=0,a=e?0:n-o),this._chartStore.getTimeScaleStore().setTotalBarSpace(s);const l={width:n},c={width:s,left:r},h={width:o,left:a};this._panes.forEach((t=>{t.setBounding(l,c,h)})),this._xAxisPane.setBounding(l,c,h)}_setPaneOptions(t,e){var i;const n=this._panes.get(t.id);let s=!1;if(void 0!==n){let o=e;if(t.id!==tt.CANDLE&&void 0!==t.height&&t.height>0){const e=Math.max(null!==(i=t.minHeight)&&void 0!==i?i:n.getOptions().minHeight,0),a=Math.max(e,t.height);n.setBounding({height:a}),o=!0,s=!0}n.setOptions(t),o&&this.adjustPaneViewport(s,!0,!0,!0,!0)}}getContainer(){return this._container}getChartStore(){return this._chartStore}adjustPaneViewport(t,e,i,n,s){t&&this._measurePaneHeight();let o=e;const a=null!=s&&s;(null!=n&&n||a)&&this._panes.forEach((t=>{const e=t.getAxisComponent().buildTicks(a);o||(o=e)})),o&&this._measurePaneWidth(),null!=i&&i&&(this._xAxisPane.getAxisComponent().buildTicks(!0),this.updatePane(4))}updatePane(t,e){var i;void 0!==e?null===(i=this.getPaneById(e))||void 0===i||i.update(t):(this._xAxisPane.update(t),this._panes.forEach((e=>{e.update(t)})))}getPaneById(t){var e;return t===tt.XAXIS?this._xAxisPane:null!==(e=this._panes.get(t))&&void 0!==e?e:null}crosshairChange(t){const e=this._chartStore.getActionStore();if(e.has("onCrosshairChange")){const i={};this._panes.forEach(((e,n)=>{const s={};this._chartStore.getIndicatorStore().getInstances(n).forEach((e=>{var i;const n=e.result;s[e.name]=n[null!==(i=t.dataIndex)&&void 0!==i?i:n.length-1]})),i[n]=s})),void 0!==t.paneId&&e.execute("onCrosshairChange",{...t,indicatorData:i})}}getDom(t,e){var i,n;if(void 0===t)return this._chartContainer;{const s=this.getPaneById(t);if(null!==s){switch(null!=e?e:"root"){case"root":return s.getContainer();case"main":return s.getMainWidget().getContainer();case"yAxis":return null!==(n=null===(i=s.getYAxisWidget())||void 0===i?void 0:i.getContainer())&&void 0!==n?n:null}}}return null}getSize(t,e){var i,n;if(void 0===t)return{width:this._chartContainer.offsetWidth,height:this._chartContainer.offsetHeight,left:0,top:0,right:0,bottom:0};{const s=this.getPaneById(t);if(null!==s){switch(null!=e?e:"root"){case"root":return s.getBounding();case"main":return s.getMainWidget().getBounding();case"yAxis":return null!==(n=null===(i=s.getYAxisWidget())||void 0===i?void 0:i.getBounding())&&void 0!==n?n:null}}}return null}setStyles(t){this._chartStore.setOptions({styles:t}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}getStyles(){return this._chartStore.getStyles()}setLocale(t){this._chartStore.setOptions({locale:t}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}getLocale(){return this._chartStore.getLocale()}setCustomApi(t){this._chartStore.setOptions({customApi:t}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}setPriceVolumePrecision(t,e){this._chartStore.setPrecision({price:t,volume:e})}getPriceVolumePrecision(){return this._chartStore.getPrecision()}setTimezone(t){this._chartStore.setOptions({timezone:t}),this._xAxisPane.getAxisComponent().buildTicks(!0),this._xAxisPane.update(3)}getTimezone(){return this._chartStore.getTimeScaleStore().getTimezone()}setOffsetRightDistance(t){this._chartStore.getTimeScaleStore().setOffsetRightDistance(t,!0)}setLeftMinVisibleBarCount(t){t>0&&this._chartStore.getTimeScaleStore().setLeftMinVisibleBarCount(Math.ceil(t))}setRightMinVisibleBarCount(t){t>0&&this._chartStore.getTimeScaleStore().setRightMinVisibleBarCount(Math.ceil(t))}setBarSpace(t){this._chartStore.getTimeScaleStore().setBarSpace(t)}getBarSpace(){return this._chartStore.getTimeScaleStore().getBarSpace().bar}getVisibleRange(){return this._chartStore.getTimeScaleStore().getVisibleRange()}clearData(){this._chartStore.clearDataList()}getDataList(){return this._chartStore.getDataList()}applyNewData(t,e){this._chartStore.clearDataList(),this.applyMoreData(t,e)}applyMoreData(t,e){this._chartStore.addData(t,0,e),this._chartStore.getIndicatorStore().calcInstance().then((t=>{(0===t.length||t.includes(!0))&&this.adjustPaneViewport(!1,!0,!0,!0)})).catch((t=>{}))}updateData(t){const e=this._chartStore.getDataList(),i=e.length,n=t.timestamp,s=f(e[i-1],"timestamp",0);if(n>=s){let e=i;n===s&&(e=i-1),this._chartStore.addData(t,e),this._chartStore.getIndicatorStore().calcInstance().then((t=>{(0===t.length||t.includes(!0))&&this.adjustPaneViewport(!1,!0,!0,!0)})).catch((t=>{}))}}loadMore(t){this._chartStore.getTimeScaleStore().setLoadMoreCallback(t)}createIndicator(t,e,n){var s,o;const a=m(t)?{name:t}:t;if(null===V(a.name))return null;let r;if(void 0!==n&&this._panes.has(n.id))r=n.id,this._chartStore.getIndicatorStore().addInstance(a,r,null!=e&&e).then((t=>{var e,i;this._setPaneOptions(n,null!==(i=null===(e=this._panes.get(r))||void 0===e?void 0:e.getAxisComponent().buildTicks(!0))&&void 0!==i&&i)})).catch((t=>{}));else{r=null!==(s=null==n?void 0:n.id)&&void 0!==s?s:i(tt.INDICATOR);const t=Array.from(this._panes.values()).pop(),l=new ge(this._chartContainer,this,r,t);t.setBottomPane(l);const c=null!==(o=null==n?void 0:n.height)&&void 0!==o?o:100;l.setBounding({height:c}),void 0!==n&&l.setOptions(n),this._panes.set(r,l),this._chartStore.getIndicatorStore().addInstance(a,r,null!=e&&e).finally((()=>{this.adjustPaneViewport(!0,!0,!0,!0,!0)}))}return r}overrideIndicator(t,e){this._chartStore.getIndicatorStore().override(t,e).then((t=>{t.length>0&&this.adjustPaneViewport(!1,!0,!0,!0)})).catch((()=>{}))}getIndicatorByPaneId(t,e){return this._chartStore.getIndicatorStore().getInstanceByPaneId(t,e)}removeIndicator(t,e){const i=this._chartStore.getIndicatorStore();if(i.removeInstance(t,e)){let e=!1;if(t!==tt.CANDLE&&!i.hasInstances(t)){const i=this._panes.get(t);if(void 0!==i){e=!0;const n=i.getTopPane(),s=i.getBottomPane();null==s||s.setTopPane(n),null==n||n.setBottomPane(s),null==i||i.destroy(),this._panes.delete(t)}}this.adjustPaneViewport(e,!0,!0,!0,!0)}}createOverlay(t,e){const i=m(t)?{name:t}:t;if(null===J(i.name))return null;let n=!0;void 0!==e&&null!==this.getPaneById(e)||(e=tt.CANDLE,n=!1);return this._chartStore.getOverlayStore().addInstance(i,e,n)}getOverlayById(t){return this._chartStore.getOverlayStore().getInstanceById(t)}overrideOverlay(t){this._chartStore.getOverlayStore().override(t)}removeOverlay(t){let e;void 0!==t&&(e=m(t)?{id:t}:t),this._chartStore.getOverlayStore().removeInstance(e)}setPaneOptions(t){this._setPaneOptions(t,!1)}setZoomEnabled(t){this._chartStore.getTimeScaleStore().setZoomEnabled(t)}isZoomEnabled(){return this._chartStore.getTimeScaleStore().getZoomEnabled()}setScrollEnabled(t){this._chartStore.getTimeScaleStore().setScrollEnabled(t)}isScrollEnabled(){return this._chartStore.getTimeScaleStore().getScrollEnabled()}scrollByDistance(t,e){const i=void 0===e||e<0?0:e,n=this._chartStore.getTimeScaleStore();if(i>0){n.startScroll();const e=(new Date).getTime(),s=()=>{const o=((new Date).getTime()-e)/i,a=o>=1,r=a?t:t*o;n.scroll(r),a||requestAnimationFrame(s)};s()}else n.startScroll(),n.scroll(t)}scrollToRealTime(t){const e=this._chartStore.getTimeScaleStore(),{bar:i}=e.getBarSpace(),n=(e.getOffsetRightBarCount()-e.getOffsetRightDistance()/i)*i;this.scrollByDistance(n,t)}scrollToDataIndex(t,e){const i=this._chartStore.getTimeScaleStore(),n=(i.getOffsetRightBarCount()+(this.getDataList().length-1-t))*i.getBarSpace().bar;this.scrollByDistance(n,e)}scrollToTimestamp(t,e){const i=C(this.getDataList(),"timestamp",t);this.scrollToDataIndex(i,e)}zoomAtCoordinate(t,e,i){const n=void 0===i||i<0?0:i,s=this._chartStore.getTimeScaleStore();if(n>0){const{bar:i}=s.getBarSpace(),o=i*t-i,a=(new Date).getTime(),r=()=>{const t=((new Date).getTime()-a)/n,l=t>=1,c=l?o:o*t;s.zoom(c/i,e),l||requestAnimationFrame(r)};r()}else s.zoom(t,e)}zoomAtDataIndex(t,e,i){const n=this._chartStore.getTimeScaleStore().dataIndexToCoordinate(e);this.zoomAtCoordinate(t,{x:n,y:0},i)}zoomAtTimestamp(t,e,i){const n=C(this.getDataList(),"timestamp",e);this.zoomAtDataIndex(t,n,i)}convertToPixel(t,e){var i;const{paneId:n=tt.CANDLE,absolute:s=!1}=e;let o=[];if(n!==tt.XAXIS){const e=this.getPaneById(n);if(null!==e){const i=this._chartStore.getTimeScaleStore(),n=e.getBounding(),a=(new Array).concat(t),r=this._xAxisPane.getAxisComponent(),l=e.getAxisComponent();o=a.map((t=>{const e={};let o=t.dataIndex;if(void 0!==t.timestamp&&(o=i.timestampToDataIndex(t.timestamp)),void 0!==o&&(e.x=null==r?void 0:r.convertToPixel(o)),void 0!==t.value){const i=null==l?void 0:l.convertToPixel(t.value);e.y=s?n.top+i:i}return e}))}}return h(t)?o:null!==(i=o[0])&&void 0!==i?i:{}}convertFromPixel(t,e){var i;const{paneId:n=tt.CANDLE,absolute:s=!1}=e;let o=[];if(n!==tt.XAXIS){const e=this.getPaneById(n);if(null!==e){const i=this._chartStore.getTimeScaleStore(),n=e.getBounding(),a=(new Array).concat(t),r=this._xAxisPane.getAxisComponent(),l=e.getAxisComponent();o=a.map((t=>{var e;const o={};if(void 0!==t.x){const n=r.convertFromPixel(t.x);o.dataIndex=n,o.timestamp=null!==(e=i.dataIndexToTimestamp(n))&&void 0!==e?e:void 0}if(void 0!==t.y){const e=s?t.y-n.top:t.y;o.value=l.convertFromPixel(e)}return o}))}}return h(t)?o:null!==(i=o[0])&&void 0!==i?i:{}}subscribeAction(t,e){this._chartStore.getActionStore().subscribe(t,e)}unsubscribeAction(t,e){this._chartStore.getActionStore().unsubscribe(t,e)}getConvertPictureUrl(t,e,i){const s=this._chartContainer.offsetWidth,a=this._chartContainer.offsetHeight,r=n("canvas",{width:`${s}px`,height:`${a}px`,boxSizing:"border-box"}),l=r.getContext("2d"),c=o(r);r.width=s*c,r.height=a*c,l.scale(c,c),l.fillStyle=null!=i?i:"#FFFFFF",l.fillRect(0,0,s,a);const h=null!=t&&t;this._panes.forEach((t=>{const e=t.getBounding();l.drawImage(t.getImage(h),0,e.top,s,e.height)}));const u=this._xAxisPane.getBounding();return l.drawImage(this._xAxisPane.getImage(h),0,u.top,s,u.height),r.toDataURL(`image/${null!=e?e:"jpeg"}`)}resize(){this.adjustPaneViewport(!0,!0,!0,!0,!0)}destroy(){this._chartContainer.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._panes.forEach((t=>{t.destroy()})),this._panes.clear(),this._xAxisPane.destroy(),this._container.removeChild(this._chartContainer)}}const Ce={};let be=1;const we={clone:c,merge:l,isString:m,isNumber:g,isValid:v,isObject:d,isArray:h,isFunction:u,isBoolean:function(t){return"boolean"==typeof t},formatValue:f,formatPrecision:y,formatBigNumber:S,formatDate:x,getLinearSlopeIntercept:X,getLinearYFromSlopeIntercept:Y,getLinearYFromCoordinates:H,checkCoordinateOnArc:function(t,e){if(Math.abs(function(t,e){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}(t,e)-e.r)<2){const{r:i,startAngle:n,endAngle:s}=e,o=i*Math.cos(n)+e.x,a=i*Math.sin(n)+e.y,r=i*Math.cos(s)+e.x,l=i*Math.sin(s)+e.y;return t.x<=Math.max(o,r)+2&&t.x>=Math.min(o,r)-2&&t.y<=Math.max(a,l)+2&&t.y>=Math.min(a,l)-2}return!1},checkCoordinateOnCircle:wt,checkCoordinateOnLine:W,checkCoordinateOnPolygon:Tt,checkCoordinateOnRect:Dt,checkCoordinateOnText:Lt,drawArc:function(t,e,i){const{x:n,y:s,r:o,startAngle:a,endAngle:r}=e,{style:l="solid",size:c=1,color:h="currentColor",dashedValue:u=[2,2]}=i;t.lineWidth=c,t.strokeStyle=h,"dashed"===l?t.setLineDash(u):t.setLineDash([]),t.beginPath(),t.arc(n,s,o,a,r),t.stroke(),t.closePath()},drawCircle:Et,drawLine:$,drawPolygon:Pt,drawRect:kt,drawText:Rt,drawRectText:Vt};t.dispose=function(t){var e;let i;if(m(t)){const n=document.getElementById(t);i=null!==(e=null==n?void 0:n.getAttribute("chartId"))&&void 0!==e?e:null}else i=t instanceof Se?t.id:null!=t?t:t.chartId;null!==i&&(Ce[i].destroy(),delete Ce[i])},t.getFigureClass=function(t){var e;return null!==(e=Nt[t])&&void 0!==e?e:null},t.getSupportFigures=function(){return Object.keys(Nt)},t.getSupportIndicators=function(){return Object.keys(R)},t.getSupportLocales=function(){return Object.keys(Jt)},t.getSupportedOverlays=function(){return Object.keys(K)},t.init=function(t,e){var i;let n;if(n=m(t)?document.getElementById(t):t,null===n)return null;let s=Ce[null!==(i=n.chartId)&&void 0!==i?i:""];if(void 0!==s)return s;const o="k_line_chart_"+be++;return s=new Se(n,e),s.id=o,n.chartId=o,Ce[o]=s,s},t.registerIndicator=function(t){R[t.name]=k.extend(t)},t.registerLocale=function(t,e){Jt[t]=e},t.registerOverlay=function(t){K[t.name]=z.extend(t)},t.registerStyles=function(t,e){ot[t]=e},t.reisterFigure=function(t){Nt[t.name]=bt.extend(t)},t.utils=we,t.version=function(){return"9.0.0-alpha4"}}));
